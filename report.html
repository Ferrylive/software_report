<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes"> 
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <title>口腔健康评估报告 - 渡生科技</title>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    :root {
      --brand-green: #8FC31F;
      --brand-blue: #2EA7E0;
      --brand-green-light: #A5D63F;
      --brand-blue-light: #5FC3E8;
      --text-dark: #1B5E20;
      --text-medium: #2E7D32;
      --text-light: #555;
      --bg-light: #F1F8E9;
      --bg-lighter: #F9FBE7;
      --border-color: #C8E6C9;
      --shadow: rgba(143, 195, 31, 0.15);
    }
    body { 
      margin: 0; 
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'PingFang SC', 'Microsoft YaHei', 'Helvetica Neue', Arial, 'Noto Sans SC', sans-serif; 
      background: linear-gradient(135deg, var(--bg-light) 0%, #E8F5E9 100%); 
      color: var(--text-dark); 
      line-height: 1.6;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
      overflow-x: hidden;
      width: 100%;
    }
    .page { 
      width: 100%; 
      max-width: 1080px; 
      margin: 24px auto 72px; 
      background: #ffffff; 
      padding: 28px 32px 40px; 
      border-radius: 16px; 
      box-shadow: 0 8px 32px var(--shadow);
      overflow-x: hidden;
      overflow-y: visible;
    }
    @media (max-width: 768px) {
      .page {
        margin: 8px auto 24px;
        padding: 18px 14px 24px;
        border-radius: 12px;
        width: calc(100% - 16px);
      }
    }
    @media (max-width: 480px) {
      .page {
        margin: 4px auto 16px;
        padding: 16px 12px 20px;
        width: calc(100% - 8px);
      }
    }
    .topbar { 
      height: 8px; 
      background: linear-gradient(90deg, var(--brand-green) 0%, var(--brand-green-light) 50%, var(--brand-blue) 100%); 
      width: 60%; 
      border-radius: 4px; 
      margin-top: 4px; 
    }
    .header { 
      display: flex; 
      align-items: center; 
      justify-content: space-between; 
      margin: 18px 0 20px; 
      flex-wrap: wrap;
      gap: 16px;
    }
    @media (max-width: 768px) {
      .header {
        flex-direction: column;
        text-align: center;
      }
    }
    .badge { 
      display: inline-block; 
      padding: 8px 16px; 
      border-radius: 20px; 
      background: linear-gradient(135deg, var(--brand-green) 0%, var(--brand-blue) 100%); 
      color: #fff; 
      font-weight: 600; 
      margin-right: 12px; 
      font-size: 14px;
      box-shadow: 0 2px 8px rgba(143, 195, 31, 0.3);
    }
    h1 { 
      margin: 0; 
      font-size: 48px; 
      letter-spacing: 1px; 
      color: var(--text-dark); 
      font-weight: 700;
    }
    @media (max-width: 768px) {
      h1 {
        font-size: 32px;
      }
    }
    .report-tag { 
      color: var(--brand-green); 
    }
    .logo { 
      height: 80px; 
      width: auto; 
      display: block; 
      object-fit: contain; 
      max-width: 200px;
    }
    @media (max-width: 768px) {
      .logo {
        height: 60px;
      }
    }
    .logo-large { 
      height: 160px; 
      width: auto; 
      display: block; 
      object-fit: contain; 
      margin-bottom: 20px;
      max-width: 300px;
    }
    @media (max-width: 768px) {
      .logo-large {
        height: 120px;
      }
    }
    .cover { 
      display: flex; 
      flex-direction: column; 
      align-items: center; 
      justify-content: center; 
      padding: 100px 32px 120px; 
      text-align: center; 
      background: linear-gradient(135deg, var(--bg-light) 0%, #E8F5E9 50%, #C8E6C9 100%); 
      border-radius: 16px; 
      position: relative;
      overflow: visible;
      min-height: 600px;
    }
    @media (max-width: 768px) {
      .cover {
        padding: 40px 16px 60px;
        min-height: auto;
      }
    }
    @media (max-width: 480px) {
      .cover {
        padding: 30px 12px 40px;
        border-radius: 12px;
      }
    }
    .cover::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: transparent;
      pointer-events: none;
    }
    .cover h1 { 
      font-size: 48px; 
      margin: 20px 0 12px; 
      color: var(--text-dark); 
      font-weight: 700;
      position: relative;
      z-index: 1;
    }
    @media (max-width: 768px) {
      .cover h1 {
        font-size: 32px;
      }
    }
    .cover .subtitle { 
      color: var(--brand-green); 
      font-size: 20px; 
      margin-top: 8px; 
      font-weight: 500;
      position: relative;
      z-index: 1;
    }
    @media (max-width: 768px) {
      .cover .subtitle {
        font-size: 16px;
      }
    }
    .cover-date {
      color: var(--brand-blue);
      font-size: 16px;
      margin-top: 8px;
      position: relative;
      z-index: 1;
    }
    @media (max-width: 768px) {
      .cover-date {
        font-size: 14px;
      }
    }
    .cover-summary { 
      margin-top: 50px; 
      padding: 40px; 
      background: rgba(255, 255, 255, 0.95); 
      border-radius: 16px; 
      box-shadow: 0 8px 24px rgba(0, 0, 0, 0.1); 
      max-width: 90%; 
      width: 100%;
      position: relative;
      z-index: 1;
      overflow: visible;
    }
    @media (max-width: 768px) {
      .cover-summary {
        padding: 24px 16px;
        margin-top: 30px;
        max-width: 95%;
      }
    }
    @media (max-width: 480px) {
      .cover-summary {
        padding: 20px 12px;
        margin-top: 20px;
        max-width: 98%;
      }
    }
    .cover-summary h2 { 
      color: var(--text-dark); 
      font-size: 28px; 
      margin: 0 0 25px 0; 
      font-weight: 700;
    }
    @media (max-width: 768px) {
      .cover-summary h2 {
        font-size: 22px;
        margin-bottom: 20px;
      }
    }
    .cover-summary .stat { 
      display: flex; 
      justify-content: space-around; 
      margin: 30px 0; 
      gap: 16px;
      flex-wrap: wrap;
      overflow: visible;
      position: relative;
    }
    .cover-summary .stat-item { 
      text-align: center; 
      flex: 1;
      min-width: 100px;
      transition: transform 0.15s cubic-bezier(0.4, 0, 0.2, 1), 
                  box-shadow 0.15s cubic-bezier(0.4, 0, 0.2, 1), 
                  background 0.15s cubic-bezier(0.4, 0, 0.2, 1);
      cursor: pointer;
      padding: 12px;
      border-radius: 12px;
      touch-action: manipulation;
      -webkit-tap-highlight-color: transparent;
      user-select: none;
      position: relative;
      z-index: 1;
      overflow: visible;
    }
    .cover-summary .stat-item:hover {
      transform: scale(1.04);
      background: rgba(143, 195, 31, 0.08);
      box-shadow: 0 3px 10px rgba(143, 195, 31, 0.2);
      z-index: 100;
    }
    .cover-summary .stat-item:active {
      transform: scale(1.02);
      background: rgba(143, 195, 31, 0.12);
      box-shadow: 0 2px 6px rgba(143, 195, 31, 0.25);
      z-index: 100;
    }
    @media (max-width: 480px) {
      .cover-summary .stat {
        gap: 12px;
        margin: 20px 0;
      }
      .cover-summary .stat-item {
        min-width: 90px;
        flex: 1 1 30%;
      }
    }
    .cover-summary .stat-number { 
      font-size: 42px; 
      font-weight: 800; 
      background: linear-gradient(135deg, var(--brand-green) 0%, var(--brand-blue) 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      margin: 8px 0; 
      text-shadow: 0 2px 4px rgba(143, 195, 31, 0.2);
    }
    @media (max-width: 768px) {
      .cover-summary .stat-number {
        font-size: 32px;
      }
    }
    @media (max-width: 480px) {
      .cover-summary .stat-number {
        font-size: 28px;
      }
    }
    .cover-summary .stat-label { 
      font-size: 16px; 
      color: var(--text-light); 
      margin-top: 8px;
    }
    @media (max-width: 768px) {
      .cover-summary .stat-label {
        font-size: 14px;
      }
    }
    @media (max-width: 480px) {
      .cover-summary .stat-label {
        font-size: 12px;
      }
    }
    .cover-summary .health-score {
      font-size: 36px;
      font-weight: 800;
      background: linear-gradient(135deg, var(--brand-green) 0%, var(--brand-blue) 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      margin: 20px 0;
    }
    .cover-summary .summary-text {
      margin: 25px 0 0 0; 
      color: var(--text-light); 
      line-height: 1.8; 
      font-size: 15px;
      text-align: left;
    }
    @media (max-width: 768px) {
      .cover-summary .summary-text {
        font-size: 14px;
      }
    }
    .cover-radar {
      margin-top: 20px;
      padding: 20px 0;
      background: transparent;
      width: 100%;
      box-sizing: border-box;
      overflow: visible;
    }
    @media (max-width: 768px) {
      .cover-radar {
        margin-top: 15px;
        padding: 15px 0;
      }
    }
    @media (max-width: 480px) {
      .cover-radar {
        margin-top: 10px;
        padding: 10px 0;
      }
    }
    .cover-radar .radar-chart {
      max-width: 100%;
      width: 100%;
      padding: 10px 0;
      box-sizing: border-box;
      overflow: visible;
    }
    @media (max-width: 768px) {
      .cover-radar .radar-chart {
        padding: 5px 0;
      }
    }
    @media (max-width: 480px) {
      .cover-radar .radar-chart {
        padding: 0;
      }
    }
    .cover-radar .radar-chart svg {
      width: 100%;
      height: auto;
      max-width: 750px;
      margin: 0 auto;
      display: block;
      overflow: visible;
      padding: 0 10px;
      box-sizing: border-box;
    }
    @media (max-width: 768px) {
      .cover-radar .radar-chart svg {
        max-width: 600px;
      }
    }
    @media (max-width: 480px) {
      .cover-radar .radar-chart svg {
        max-width: 480px;
      }
    }
    .layout { 
      display: block;
      margin-top: 20px;
      overflow: visible;
    }
    .overview-image-section {
      margin-bottom: 24px;
      background: #ffffff;
      border: 2px solid var(--border-color);
      border-radius: 12px;
      padding: 20px 24px;
      box-shadow: 0 2px 8px rgba(143, 195, 31, 0.08);
      position: relative;
    }
    .overview-image-section::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 4px;
      height: 100%;
      background: linear-gradient(180deg, var(--brand-green) 0%, var(--brand-blue) 100%);
      border-radius: 12px 0 0 12px;
    }
    .overview-image-section img {
      width: 100%;
      max-width: 800px;
      height: auto;
      border-radius: 8px;
      display: block;
      margin: 0 auto;
      border: 1px solid var(--bg-light);
    }
    .treatment-tag {
      display: inline-block;
      padding: 4px 12px;
      margin: 2px 4px;
      background: linear-gradient(135deg, var(--brand-green) 0%, var(--brand-blue) 100%);
      color: white;
      border-radius: 12px;
      font-size: 12px;
      font-weight: 600;
    }
    .treatment-section {
      margin-top: 24px;
    }
    .treatment-item {
      margin-bottom: 32px;
      padding: 20px;
      background: var(--bg-lighter);
      border-radius: 12px;
      border: 2px solid var(--border-color);
      transition: transform 0.15s cubic-bezier(0.4, 0, 0.2, 1), 
                  box-shadow 0.15s cubic-bezier(0.4, 0, 0.2, 1),
                  background 0.15s cubic-bezier(0.4, 0, 0.2, 1),
                  border-color 0.15s cubic-bezier(0.4, 0, 0.2, 1);
      touch-action: manipulation;
      cursor: pointer;
      -webkit-tap-highlight-color: transparent;
      user-select: none;
    }
    .treatment-item:hover {
      transform: scale(1.02);
      box-shadow: 0 3px 10px rgba(143, 195, 31, 0.2);
      background: rgba(143, 195, 31, 0.05);
      border-color: var(--brand-green);
    }
    .treatment-item:active {
      transform: scale(1.015);
      box-shadow: 0 2px 8px rgba(143, 195, 31, 0.2);
      background: rgba(143, 195, 31, 0.08);
      border-color: var(--brand-green);
    }
    .treatment-item h4 {
      margin: 0 0 16px 0;
      color: var(--text-dark);
      font-size: 22px;
      font-weight: 700;
    }
    .treatment-subsection {
      margin: 20px 0;
    }
    .treatment-subsection h5 {
      margin: 0 0 12px 0;
      color: var(--text-dark);
      font-size: 18px;
      font-weight: 600;
    }
    .treatment-subsection ul {
      margin: 8px 0;
      padding-left: 24px;
      line-height: 1.8;
      color: var(--text-light);
    }
    .treatment-subsection li {
      margin: 8px 0;
    }
    .treatment-step {
      margin: 12px 0;
      padding: 12px;
      background: rgba(255, 255, 255, 0.8);
      border-radius: 6px;
      border-left: 3px solid var(--brand-blue);
    }
    .treatment-step strong {
      color: var(--text-dark);
      display: block;
      margin-bottom: 6px;
    }
    .qa-item {
      margin: 16px 0;
      padding: 16px;
      background: rgba(255, 255, 255, 0.6);
      border-radius: 6px;
    }
    .qa-item strong {
      color: var(--brand-green);
      display: block;
      margin-bottom: 8px;
    }
    .section { 
      margin-bottom: 24px; 
      background: #ffffff; 
      border: 2px solid var(--border-color); 
      border-radius: 12px; 
      padding: 20px 24px; 
      box-shadow: 0 2px 8px rgba(143, 195, 31, 0.08);
      position: relative;
      overflow: visible;
    }
    .section::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 4px;
      height: 100%;
      background: linear-gradient(180deg, var(--brand-green) 0%, var(--brand-blue) 100%);
      border-radius: 12px 0 0 12px;
    }
    @media (max-width: 768px) {
      .section {
        padding: 16px 12px;
        margin-bottom: 16px;
        overflow: visible !important;
      }
    }
    @media (max-width: 480px) {
      .section {
        padding: 14px 10px;
        margin-bottom: 14px;
        overflow: visible !important;
      }
    }
    .section h3 { 
      margin: 0 0 16px; 
      color: var(--text-dark); 
      font-size: 22px; 
      display: flex; 
      align-items: center; 
      font-weight: 700;
      transition: color 0.2s;
    }
    .section h3:hover {
      color: var(--brand-green);
    }
    @media (max-width: 768px) {
      .section h3 {
        font-size: 18px;
        margin-bottom: 12px;
      }
    }
    .section h3::before { 
      content: ""; 
      display: inline-block; 
      width: 6px; 
      height: 24px; 
      background: linear-gradient(180deg, var(--brand-green) 0%, var(--brand-blue) 100%);
      border-radius: 3px;
      margin-right: 12px; 
    }
    .section h3 span[id$="-icon"] {
      font-size: 14px;
      margin-right: 8px;
      transition: transform 0.3s;
    }
    .section p { 
      margin: 0; 
      line-height: 1.8; 
      color: #424242; 
    }
    .right h3 { 
      color: var(--brand-green); 
      margin: 6px 0 16px; 
      font-size: 22px; 
      font-weight: 700;
    }
    @media (max-width: 768px) {
      .right h3 {
        font-size: 18px;
      }
    }
    .chips { 
      display: flex; 
      flex-wrap: wrap; 
      gap: 10px 12px; 
      margin: 12px 0 20px; 
    }
    .chip { 
      background: linear-gradient(135deg, var(--brand-green) 0%, var(--brand-blue) 100%); 
      color: #fff; 
      border-radius: 20px; 
      padding: 8px 16px; 
      font-weight: 700; 
      min-width: 48px; 
      text-align: center; 
      font-size: 15px;
      box-shadow: 0 2px 6px rgba(143, 195, 31, 0.3);
    }
    .grid { 
      display: grid; 
      grid-template-columns: repeat(3, minmax(0, 1fr)); 
      gap: 16px; 
      width: 100%;
      box-sizing: border-box;
    }
    @media (max-width: 980px) { 
      .grid { grid-template-columns: repeat(2, minmax(0, 1fr)); } 
    }
    @media (max-width: 640px) {
      .grid {
        grid-template-columns: 1fr;
      }
    }
    .cell { 
      background: #ffffff; 
      padding: 12px; 
      border: 2px solid var(--border-color); 
      border-radius: 12px; 
      transition: transform 0.2s, box-shadow 0.2s;
    }
    .cell:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(143, 195, 31, 0.2);
    }
    .cell img { 
      width: 100%; 
      aspect-ratio: 1 / 1; 
      object-fit: cover; 
      border-radius: 8px; 
      display: block; 
      border: 1px solid var(--bg-light);
    }
    .meta { 
      font-size: 14px; 
      color: var(--text-light); 
      margin-top: 10px; 
      line-height: 1.6; 
    }
    footer { 
      margin-top: 32px; 
      padding-top: 24px; 
      border-top: 2px solid var(--bg-light);
      color: #666; 
      font-size: 14px; 
      text-align: center;
    }
    .legend { 
      margin-top: 12px; 
      font-size: 13px; 
      color: var(--brand-green); 
      text-align: center;
    }
    .tooth-chart { 
      width: 100%; 
      max-width: 100%; 
      margin: 0; 
      background: transparent; 
      padding: 20px 0; 
      border: none; 
      box-shadow: none;
      overflow: visible;
      box-sizing: border-box;
      position: relative;
    }
    .tooth-arch-container {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 30px;
      width: 100%;
      max-width: 100%;
      margin: 0 auto;
      padding: 20px 5px;
      overflow: visible;
    }
    @media (max-width: 768px) {
      .tooth-arch-container {
        gap: 20px;
        padding: 20px 3px;
        overflow: visible;
      }
    }
    @media (max-width: 480px) {
      .tooth-arch-container {
        gap: 15px;
        padding: 20px 2px;
        overflow: visible;
      }
    }
    .tooth-arch-section {
      width: 100%;
      display: flex;
      flex-direction: column;
      align-items: center;
      min-height: auto;
      padding: 0;
      margin: 0;
    }
    @media (max-width: 768px) {
      .tooth-arch-section {
        min-height: auto;
      }
    }
    @media (max-width: 480px) {
      .tooth-arch-section {
        min-height: auto;
      }
    }
    .tooth-arch-title {
      display: none;
    }
    .tooth-arch-svg {
      width: 100%;
      height: auto;
      max-width: 100%;
      overflow: visible;
      display: block;
      min-height: 300px;
    }
    @media (max-width: 768px) {
      .tooth-arch-svg {
        min-height: 250px;
      }
    }
    @media (max-width: 480px) {
      .tooth-arch-svg {
        min-height: 200px;
      }
    }
    /* SVG牙齿样式 */
    .tooth-shape {
      cursor: pointer;
      transition: all 0.2s ease;
      stroke-width: 7;
    }
    .tooth-shape:hover {
      filter: brightness(0.9);
      stroke-width: 8;
    }
    .tooth-shape.normal {
      fill: #E8F5E9;
      stroke: var(--brand-green);
      stroke-width: 7;
    }
    .tooth-shape.single {
      fill: #FFD54F;
      stroke: #F57C00;
      stroke-width: 7.5;
    }
    .tooth-shape.multiple {
      fill: #FF7043;
      stroke: #D84315;
      stroke-width: 7.5;
    }
    .tooth-shape.online {
      fill: #4CAF50;
      stroke: #2E7D32;
      stroke-width: 7.5;
    }
    .tooth-shape.offline {
      fill: #D32F2F;
      stroke: #B71C1C;
      stroke-width: 7.5;
    }
    @media (max-width: 768px) {
      .tooth-shape {
        stroke-width: 7;
      }
      .tooth-shape:hover {
        stroke-width: 7.5;
      }
      .tooth-shape.single,
      .tooth-shape.multiple,
      .tooth-shape.online,
      .tooth-shape.offline {
        stroke-width: 7.5;
      }
    }
    .tooth-number-text {
      font-size: 38px;
      font-weight: 700;
      fill: var(--text-dark);
      pointer-events: none;
      text-anchor: middle;
      dominant-baseline: middle;
    }
    @media (max-width: 768px) {
      .tooth-number-text {
        font-size: 34px;
      }
    }
    @media (max-width: 480px) {
      .tooth-number-text {
        font-size: 32px;
      }
    }
    .tooth-shape.single + .tooth-number-text {
      fill: #D84315;
    }
    .tooth-shape.multiple + .tooth-number-text,
    .tooth-shape.online + .tooth-number-text,
    .tooth-shape.offline + .tooth-number-text {
      fill: #fff;
    }
    /* PNG牙齿图片样式 */
    .tooth-image {
      cursor: pointer;
      transition: all 0.2s ease;
      pointer-events: all;
    }
    .tooth-image:hover {
      filter: brightness(0.9);
    }
    .tooth-item {
      cursor: pointer;
      transition: opacity 0.2s;
    }
    .tooth-item:hover {
      opacity: 0.9;
    }
    .tooth-tooltip {
      position: absolute;
      background: rgba(0, 0, 0, 0.9);
      color: white;
      padding: 10px 14px;
      border-radius: 6px;
      font-size: 13px;
      pointer-events: none;
      z-index: 1000;
      display: none;
      max-width: 250px;
      line-height: 1.5;
      box-shadow: 0 4px 12px rgba(0,0,0,0.3);
      font-weight: 500;
    }
    .tooth-tooltip.show {
      display: block;
    }
    @media (max-width: 768px) {
      .tooth-tooltip {
        font-size: 12px;
        padding: 8px 12px;
        max-width: 200px;
      }
    }
    .radar-chart { 
      width: 100%; 
      max-width: 100%; 
      margin: 20px auto; 
      background: var(--bg-lighter); 
      padding: 20px; 
      border-radius: 12px; 
      border: 2px solid var(--brand-green);
      box-sizing: border-box;
      overflow: hidden;
    }
    .radar-chart svg {
      width: 100%;
      height: auto;
      max-width: 100%;
      display: block;
    }
    .summary-stats {
      display: flex;
      gap: 20px;
      margin: 20px 0;
      flex-wrap: wrap;
      overflow: visible;
      position: relative;
      z-index: 1;
    }
    @media (max-width: 768px) {
      .summary-stats {
        gap: 12px;
        overflow: visible !important;
      }
    }
    .stat-box {
      flex: 1;
      text-align: center;
      padding: 20px;
      background: linear-gradient(135deg, var(--bg-light) 0%, var(--bg-lighter) 100%);
      border-radius: 12px;
      border: 2px solid var(--border-color);
      min-width: 120px;
      transition: transform 0.15s cubic-bezier(0.4, 0, 0.2, 1), 
                  box-shadow 0.15s cubic-bezier(0.4, 0, 0.2, 1), 
                  border-color 0.15s cubic-bezier(0.4, 0, 0.2, 1);
      cursor: pointer;
      touch-action: manipulation;
      -webkit-tap-highlight-color: transparent;
      user-select: none;
      position: relative;
      z-index: 1;
    }
    .stat-box:hover {
      transform: scale(1.03);
      box-shadow: 0 4px 12px rgba(143, 195, 31, 0.25);
      border-color: var(--brand-green);
      background: linear-gradient(135deg, #E8F5E9 0%, var(--bg-lighter) 100%);
      z-index: 100;
    }
    .stat-box:active {
      transform: scale(1.02);
      box-shadow: 0 3px 8px rgba(143, 195, 31, 0.3);
      border-color: var(--brand-green);
      z-index: 100;
    }
    @media (max-width: 768px) {
      .stat-box {
        padding: 16px;
        min-width: 100px;
      }
    }
    .stat-box.highlight {
      background: linear-gradient(135deg, var(--brand-green) 0%, var(--brand-blue) 100%);
      color: white;
      border-color: var(--brand-green);
    }
    .stat-box.highlight .stat-number,
    .stat-box.highlight .stat-label {
      color: white;
    }
    .stat-box .stat-number {
      font-size: 36px;
      font-weight: 800;
      background: linear-gradient(135deg, var(--brand-green) 0%, var(--brand-blue) 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      margin: 8px 0;
    }
    .stat-box.highlight .stat-number {
      -webkit-text-fill-color: white;
      background: none;
    }
    @media (max-width: 768px) {
      .stat-box .stat-number {
        font-size: 28px;
      }
    }
    .stat-box .stat-label {
      font-size: 14px;
      color: var(--text-light);
      margin-top: 8px;
    }
    .disease-list {
      line-height: 2.2;
      padding-left: 20px;
    }
    .disease-list li {
      margin: 8px 0;
      color: #424242;
    }
    .recommendations {
      margin-top: 16px;
    }
    .rec-item {
      margin-bottom: 24px;
      padding: 16px;
      background: var(--bg-lighter);
      border-radius: 8px;
      border-left: 4px solid var(--brand-blue);
      transition: transform 0.15s cubic-bezier(0.4, 0, 0.2, 1), 
                  box-shadow 0.15s cubic-bezier(0.4, 0, 0.2, 1),
                  background 0.15s cubic-bezier(0.4, 0, 0.2, 1);
      touch-action: manipulation;
      cursor: pointer;
      -webkit-tap-highlight-color: transparent;
      user-select: none;
    }
    .rec-item:active {
      transform: scale(1.02);
      box-shadow: 0 3px 10px rgba(143, 195, 31, 0.2);
      background: rgba(143, 195, 31, 0.05);
    }
    .rec-item:active {
      transform: scale(1.02);
      box-shadow: 0 3px 10px rgba(143, 195, 31, 0.2);
      background: rgba(143, 195, 31, 0.05);
    }
    .rec-item strong {
      color: var(--text-dark);
      font-size: 16px;
      display: block;
      margin-bottom: 12px;
    }
    .rec-item ul {
      margin: 8px 0 0 0;
      padding-left: 24px;
      line-height: 1.8;
      color: var(--text-light);
    }
    .rec-item li {
      margin: 6px 0;
    }
    .cause-item {
      margin-bottom: 24px; 
      padding: 20px;
      display: grid;
      grid-template-columns: 1fr auto;
      gap: 20px;
      align-items: start;
      transition: transform 0.15s cubic-bezier(0.4, 0, 0.2, 1), 
                  box-shadow 0.15s cubic-bezier(0.4, 0, 0.2, 1),
                  background 0.15s cubic-bezier(0.4, 0, 0.2, 1);
      touch-action: manipulation;
      cursor: pointer;
      -webkit-tap-highlight-color: transparent;
      user-select: none;
    }
    .cause-item:hover {
      transform: scale(1.02);
      box-shadow: 0 3px 10px rgba(143, 195, 31, 0.2);
      background: rgba(143, 195, 31, 0.05);
    }
    .cause-item:active {
      transform: scale(1.015);
      box-shadow: 0 2px 8px rgba(143, 195, 31, 0.2);
      background: rgba(143, 195, 31, 0.08);
    }
    @media (max-width: 1024px) {
      .cause-item {
        gap: 16px;
        padding: 16px;
      }
    }
    @media (max-width: 768px) {
      .cause-item {
        grid-template-columns: 1fr;
        gap: 12px;
        padding: 16px 12px;
      }
    }
    .cause-item-content {
      min-width: 0;
    }
    .cause-item h4 {
      margin: 0 0 12px 0; 
      color: var(--text-dark); 
      font-size: 20px;
      font-weight: 700;
    }
    .cause-item-thumbs {
      display: grid;
      grid-template-columns: repeat(auto-fit, 120px);
      gap: 12px;
      max-width: 380px;
      width: auto;
      justify-content: flex-end;
      justify-items: end;
    }
    @media (max-width: 1024px) {
      .cause-item-thumbs {
        grid-template-columns: repeat(auto-fit, 110px);
        max-width: 350px;
        gap: 10px;
      }
    }
    @media (max-width: 768px) {
      .cause-item-thumbs {
        max-width: 100%;
        grid-template-columns: repeat(auto-fit, minmax(90px, 1fr));
        justify-content: center;
        justify-items: center;
      }
    }
    @media (max-width: 480px) {
      .cause-item-thumbs {
        grid-template-columns: repeat(auto-fit, minmax(80px, 1fr));
      }
    }
    .cause-image-item {
      width: 120px;
      height: 120px;
      border-radius: 8px;
      overflow: hidden;
      border: 2px solid var(--brand-green);
      box-shadow: 0 2px 6px rgba(143, 195, 31, 0.3);
      background: #fff;
    }
    @media (max-width: 1024px) {
      .cause-image-item {
        width: 110px;
        height: 110px;
      }
    }
    @media (max-width: 768px) {
      .cause-image-item {
        width: 100%;
        height: auto;
        aspect-ratio: 1;
        max-width: 120px;
      }
    }
    .cause-image-item img {
      width: 100%;
      height: 100%;
      display: block;
      object-fit: cover;
    }
    .cause-item-thumb {
      width: 100%;
      max-width: 200px;
      border-radius: 8px;
      overflow: hidden;
      border: 2px solid var(--brand-green);
      box-shadow: 0 2px 6px rgba(143, 195, 31, 0.3);
      background: #fff;
    }
    .cause-item-thumb img {
      width: 100%;
      height: auto;
      display: block;
      object-fit: cover;
    }
    .cause-teeth {
      margin: 8px 0; 
      color: #424242; 
      font-size: 15px;
    }
    .cause-title {
      margin: 12px 0 8px 0; 
      color: #424242; 
      font-size: 15px;
    }
    .cause-list {
      margin: 12px 0; 
      padding-left: 24px; 
      color: var(--text-light); 
      line-height: 1.8;
    }
    .cause-list li {
      margin: 6px 0;
    }
    .sketch-container {
      margin: 20px 0;
      padding: 20px;
      background: var(--bg-lighter);
      border-radius: 12px;
      border: 2px dashed var(--brand-green);
      text-align: center;
    }
    .sketch-placeholder {
      color: var(--text-light);
      font-style: italic;
      padding: 40px 20px;
    }
    @page { 
      size: A4; 
      margin: 12mm; 
    }
    @media print {
      body { 
        -webkit-print-color-adjust: exact; 
        print-color-adjust: exact; 
        font-size: 12px; 
        background: white;
      }
      .page { 
        break-after: page; 
        page-break-after: always; 
        box-shadow: none; 
        max-width: 100%; 
        margin: 0; 
        border-radius: 0; 
        page-break-inside: avoid; 
      }
      .header h1 { font-size: 28px; }
      .badge { padding: 4px 10px; font-size: 12px; }
      .section { margin-bottom: 10px; padding: 10px 12px; }
      .section h3 { font-size: 16px; }
      .section p { line-height: 1.6; }
      .right h3 { font-size: 16px; }
      .chips { gap: 6px 8px; }
      .logo { height: 60px; }
    }
    
    /* 移动端专项优化 - 防止内容溢出和错行 */
    @media (max-width: 768px) {
      /* 移动端关键优化 - 防止元素被裁剪 */
      body, html {
        overflow-x: hidden;
        overflow-y: auto;
      }
      
      .page {
        overflow: visible !important;
      }
      
      .layout {
        overflow: visible !important;
      }
      
      .section {
        overflow: visible !important;
      }
      
      .summary-stats {
        overflow: visible !important;
        padding: 10px 0;
      }
      
      /* 确保表格容器可以横向滚动 */
      .section > div:not(.summary-stats) {
        overflow-x: auto;
        -webkit-overflow-scrolling: touch;
      }
      
      /* 表格样式优化 */
      table {
        min-width: 500px !important;
        display: table !important;
        font-size: 13px !important;
      }
      
      table th {
        padding: 10px 8px !important;
        font-size: 13px !important;
        white-space: nowrap;
      }
      
      table td {
        padding: 12px 8px !important;
        font-size: 13px !important;
      }
      
      /* 标签芯片优化 */
      .chip {
        padding: 4px 10px !important;
        font-size: 11px !important;
        margin-right: 4px !important;
        white-space: nowrap;
        display: inline-block !important;
      }
      
      /* 文字不要过度换行 */
      .cause-item-text {
        min-width: 200px;
      }
      
      /* 治疗方案卡片优化 */
      .treatment-card {
        padding: 16px 14px !important;
      }
      
      .treatment-card h4 {
        font-size: 16px !important;
      }
      
      .treatment-card p,
      .treatment-card li {
        font-size: 13px !important;
        line-height: 1.6;
      }
      
      /* 概要框优化 */
      .summary-stats {
        overflow-x: auto;
        -webkit-overflow-scrolling: touch;
      }
    }
    
    @media (max-width: 480px) {
      /* 超小屏幕进一步优化 */
      body {
        font-size: 14px;
      }
      
      .page {
        margin: 8px auto 24px;
        padding: 16px 12px 24px;
      }
      
      table {
        min-width: 450px !important;
        font-size: 12px !important;
      }
      
      table th,
      table td {
        padding: 8px 6px !important;
        font-size: 12px !important;
      }
      
      .chip {
        padding: 3px 8px !important;
        font-size: 10px !important;
      }
      
      /* 病因分析在超小屏幕上堆叠显示 */
      .cause-item {
        flex-direction: column !important;
        gap: 12px !important;
      }
      
      .cause-item-text {
        min-width: 100%;
        width: 100%;
      }
      
      .cause-item-thumbs {
        max-width: 100% !important;
        justify-content: center;
      }
      
      /* 疾病统计条在小屏幕上优化 */
      #disease-distribution-content > div {
        padding: 12px !important;
      }
      
      #disease-distribution-content span {
        font-size: 10px !important;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
      }
    }
    
    /* 疾病统计卡片交互效果 */
    .disease-stat-card {
      transition: transform 0.15s cubic-bezier(0.4, 0, 0.2, 1), 
                  box-shadow 0.15s cubic-bezier(0.4, 0, 0.2, 1), 
                  background 0.15s cubic-bezier(0.4, 0, 0.2, 1) !important;
      cursor: pointer;
      touch-action: manipulation;
      -webkit-tap-highlight-color: transparent;
      user-select: none;
    }
    .disease-stat-card:hover {
      transform: scale(1.02) !important;
      box-shadow: 0 3px 10px rgba(143, 195, 31, 0.2) !important;
      background: rgba(143, 195, 31, 0.05) !important;
    }
    .disease-stat-card:active {
      transform: scale(1.015) !important;
      background: rgba(143, 195, 31, 0.08) !important;
      box-shadow: 0 2px 6px rgba(143, 195, 31, 0.25) !important;
    }
    .disease-number {
      transition: transform 0.15s cubic-bezier(0.4, 0, 0.2, 1);
    }
    .disease-bar {
      transition: transform 0.15s cubic-bezier(0.4, 0, 0.2, 1);
    }
    
    /* 图片交互效果 */
    .cause-image-item {
      transition: transform 0.2s cubic-bezier(0.4, 0, 0.2, 1), 
                  box-shadow 0.2s cubic-bezier(0.4, 0, 0.2, 1),
                  opacity 0.2s ease;
      cursor: pointer;
      touch-action: manipulation;
      -webkit-tap-highlight-color: transparent;
      position: relative;
    }
    .cause-image-item:hover {
      transform: scale(1.05);
      box-shadow: 0 4px 12px rgba(143, 195, 31, 0.3);
      z-index: 10;
    }
    .cause-image-item:active {
      opacity: 0.9;
    }
    .overview-image-section img {
      transition: opacity 0.2s ease, box-shadow 0.2s ease;
      cursor: pointer;
      touch-action: manipulation;
      -webkit-tap-highlight-color: transparent;
    }
    .overview-image-section img:hover {
      box-shadow: 0 4px 16px rgba(143, 195, 31, 0.25);
    }
    .overview-image-section img:active {
      opacity: 0.9;
    }
    
    /* 移动端触摸反馈 - 快速轻量的视觉反馈 */
    .touch-active.stat-item {
      transform: scale(1.04) !important;
      background: rgba(143, 195, 31, 0.12) !important;
      box-shadow: 0 2px 8px rgba(143, 195, 31, 0.25) !important;
      z-index: 100 !important;
    }
    .touch-active.stat-box {
      transform: scale(1.03) !important;
      box-shadow: 0 4px 12px rgba(143, 195, 31, 0.3) !important;
      border-color: var(--brand-green) !important;
      background: linear-gradient(135deg, #E8F5E9 0%, var(--bg-lighter) 100%) !important;
      z-index: 100 !important;
    }
    .touch-active.disease-stat-card {
      background: rgba(143, 195, 31, 0.08) !important;
      box-shadow: 0 2px 8px rgba(143, 195, 31, 0.2) !important;
    }
    .touch-active.cause-image-item {
      transform: scale(1.05) !important;
      box-shadow: 0 4px 12px rgba(143, 195, 31, 0.3) !important;
      z-index: 10 !important;
    }
    .touch-active.tooth-item {
      opacity: 0.85 !important;
    }
    .touch-active.tooth-item .tooth-shape {
      filter: brightness(0.9) !important;
      stroke-width: 3 !important;
    }
    img.touch-active {
      opacity: 0.9 !important;
    }
    .touch-active.cause-item {
      transform: scale(1.02) !important;
      box-shadow: 0 3px 10px rgba(143, 195, 31, 0.2) !important;
      background: rgba(143, 195, 31, 0.05) !important;
    }
    .touch-active.rec-item {
      transform: scale(1.02) !important;
      box-shadow: 0 3px 10px rgba(143, 195, 31, 0.2) !important;
      background: rgba(143, 195, 31, 0.08) !important;
    }
    .touch-active.treatment-item {
      transform: scale(1.01) !important;
      box-shadow: 0 2px 8px rgba(143, 195, 31, 0.15) !important;
    }
    
    /* 图片全屏查看遮罩 */
    .image-fullscreen-overlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.9);
      z-index: 9999;
      cursor: zoom-out;
      animation: fadeIn 0.3s ease;
    }
    .image-fullscreen-overlay.active {
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 20px;
    }
    .image-fullscreen-overlay img {
      max-width: 95%;
      max-height: 95%;
      object-fit: contain;
      border-radius: 8px;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
      animation: zoomIn 0.3s ease;
      cursor: zoom-out;
    }
    .image-fullscreen-close {
      position: absolute;
      top: 20px;
      right: 20px;
      width: 40px;
      height: 40px;
      background: rgba(255, 255, 255, 0.9);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      font-size: 24px;
      color: var(--text-dark);
      font-weight: bold;
      transition: transform 0.2s ease, background 0.2s ease;
      z-index: 10000;
    }
    .image-fullscreen-close:hover,
    .image-fullscreen-close:active {
      transform: scale(1.1);
      background: white;
    }
    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }
    @keyframes zoomIn {
      from { transform: scale(0.8); opacity: 0; }
      to { transform: scale(1); opacity: 1; }
    }
    
    /* 牙齿详情模态框 */
    .tooth-detail-modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.85);
      z-index: 9999;
      overflow-y: auto;
      animation: fadeIn 0.3s ease;
      padding: 20px;
    }
    .tooth-detail-modal.active {
      display: flex;
      align-items: center;
      justify-content: center;
    }
    @media (max-width: 768px) {
      .tooth-detail-modal {
        padding: 10px;
        align-items: flex-start;
        padding-top: 60px;
      }
    }
    .tooth-detail-content {
      background: white;
      border-radius: 16px;
      max-width: 900px;
      width: 100%;
      max-height: 90vh;
      overflow-y: auto;
      position: relative;
      animation: zoomIn 0.3s ease;
    }
    @media (max-width: 768px) {
      .tooth-detail-content {
        max-width: 100%;
        max-height: calc(100vh - 70px);
        border-radius: 12px;
      }
    }
    .tooth-detail-header {
      padding: 24px 28px;
      background: linear-gradient(135deg, var(--bg-light) 0%, #E8F5E9 100%);
      border-radius: 16px 16px 0 0;
      position: sticky;
      top: 0;
      z-index: 10;
      border-bottom: 2px solid var(--border-color);
    }
    @media (max-width: 768px) {
      .tooth-detail-header {
        padding: 16px 18px;
      }
    }
    .tooth-detail-close {
      position: absolute;
      top: 20px;
      right: 20px;
      width: 36px;
      height: 36px;
      background: white;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      font-size: 24px;
      color: var(--text-dark);
      font-weight: bold;
      transition: all 0.2s ease;
      border: 2px solid var(--border-color);
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    }
    .tooth-detail-close:hover {
      transform: scale(1.1);
      background: var(--brand-green);
      color: white;
      border-color: var(--brand-green);
    }
    @media (max-width: 768px) {
      .tooth-detail-close {
        top: 12px;
        right: 12px;
        width: 32px;
        height: 32px;
        font-size: 20px;
      }
    }
    .tooth-detail-title {
      font-size: 28px;
      font-weight: 700;
      color: var(--text-dark);
      margin-bottom: 8px;
    }
    @media (max-width: 768px) {
      .tooth-detail-title {
        font-size: 22px;
      }
    }
    .tooth-detail-subtitle {
      font-size: 16px;
      color: var(--text-light);
    }
    @media (max-width: 768px) {
      .tooth-detail-subtitle {
        font-size: 14px;
      }
    }
    .tooth-detail-body {
      padding: 28px;
    }
    @media (max-width: 768px) {
      .tooth-detail-body {
        padding: 18px;
      }
    }
    .tooth-detail-section {
      margin-bottom: 28px;
    }
    .tooth-detail-section:last-child {
      margin-bottom: 0;
    }
    .tooth-detail-section h3 {
      font-size: 20px;
      font-weight: 700;
      color: var(--text-dark);
      margin-bottom: 16px;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    @media (max-width: 768px) {
      .tooth-detail-section h3 {
        font-size: 18px;
      }
    }
    .tooth-detail-section h3::before {
      content: "";
      display: inline-block;
      width: 4px;
      height: 20px;
      background: linear-gradient(180deg, var(--brand-green) 0%, var(--brand-blue) 100%);
      border-radius: 2px;
    }
    .tooth-detail-images {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 16px;
      margin-bottom: 20px;
    }
    @media (max-width: 768px) {
      .tooth-detail-images {
        grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
        gap: 12px;
      }
    }
    .tooth-detail-image {
      width: 100%;
      aspect-ratio: 1;
      border-radius: 8px;
      overflow: hidden;
      border: 2px solid var(--brand-green);
      box-shadow: 0 2px 8px rgba(143, 195, 31, 0.2);
      cursor: pointer;
      transition: transform 0.2s;
    }
    .tooth-detail-image:hover {
      transform: scale(1.05);
    }
    .tooth-detail-image img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }
    .tooth-detail-text {
      color: var(--text-light);
      line-height: 1.8;
      font-size: 15px;
    }
    @media (max-width: 768px) {
      .tooth-detail-text {
        font-size: 14px;
      }
    }
    .tooth-detail-text ul {
      margin: 12px 0;
      padding-left: 24px;
    }
    .tooth-detail-text li {
      margin: 8px 0;
    }
    .tooth-status-badge {
      display: inline-block;
      padding: 6px 14px;
      border-radius: 16px;
      font-size: 13px;
      font-weight: 600;
      margin-left: 12px;
    }
    .tooth-status-badge.normal {
      background: #E8F5E9;
      color: var(--brand-green);
    }
    .tooth-status-badge.warning {
      background: #FFF3E0;
      color: #F57C00;
    }
    .tooth-status-badge.danger {
      background: #FFEBEE;
      color: #D32F2F;
    }
    
  </style>
  <script>
    // 生成唯一报告编号
    function generateReportID() {
      const now = new Date();
      const dateStr = now.getFullYear().toString() + 
                      (now.getMonth() + 1).toString().padStart(2, '0') + 
                      now.getDate().toString().padStart(2, '0');
      const userName = 'ZH'; // 可以从数据中获取
      const serial = Math.floor(Math.random() * 1000).toString().padStart(3, '0');
      const hash = Math.random().toString(36).substring(2, 6).toUpperCase();
      return `DY-${dateStr}-${userName}${serial}-${hash}`;
    }
    
    // 更新报告日期和编号显示
    window.addEventListener('DOMContentLoaded', function() {
      // 更新报告编号（同时更新封面和内页）
      const reportID = generateReportID();
      const reportIDElement = document.querySelector('.report-id-number');
      const reportIDCoverElement = document.querySelector('.report-id-number-cover');
      if (reportIDElement) {
        reportIDElement.textContent = reportID;
      }
      if (reportIDCoverElement) {
        reportIDCoverElement.textContent = reportID;
      }
      
      // 更新报告日期和时间
      const now = new Date();
      const year = now.getFullYear();
      const month = (now.getMonth() + 1).toString().padStart(2, '0');
      const day = now.getDate().toString().padStart(2, '0');
      const hours = now.getHours().toString().padStart(2, '0');
      const minutes = now.getMinutes().toString().padStart(2, '0');
      
      // 更新封面日期和时间
      const reportDateElement = document.getElementById('report-date');
      const reportTimeElement = document.getElementById('report-time');
      if (reportDateElement) {
        reportDateElement.textContent = `${year}年${month}月${day}日`;
      }
      if (reportTimeElement) {
        reportTimeElement.textContent = `${hours}:${minutes}`;
      }
      
      // 更新页脚日期和时间
      const footerDateElement = document.getElementById('footer-date');
      const footerTimeElement = document.getElementById('footer-time');
      if (footerDateElement) {
        footerDateElement.textContent = `${year}年${month}月${day}日`;
      }
      if (footerTimeElement) {
        footerTimeElement.textContent = `${hours}:${minutes}`;
      }
    });
    
    // 嵌入的报告数据（备用方案）- 使用FDI国际标准编号
    const EMBEDDED_DATA = {
      "diseased_teeth": [
        {
          "tooth_fdi": "13",
          "diseases": [
            {"label": "tooth abrasion", "confidence": 0.969},
            {"label": "tooth abrasion", "confidence": 0.957}
          ],
          "square_crop_path": "images/原始照片_tooth_3.png"
        },
        {
          "tooth_fdi": "18",
          "diseases": [
            {"label": "tooth abrasion", "confidence": 0.956}
          ],
          "square_crop_path": "images/原始照片_tooth_8.png"
        },
        {
          "tooth_fdi": "42",
          "diseases": [
            {"label": "tooth abrasion", "confidence": 0.961},
            {"label": "tooth abrasion", "confidence": 0.947},
            {"label": "tooth abrasion", "confidence": 0.904}
          ],
          "square_crop_path": "images/原始照片_tooth_26.png"
        },
        {
          "tooth_fdi": "12",
          "diseases": [
            {"label": "general_caries", "confidence": 0.984},
            {"label": "tooth abrasion", "confidence": 0.961},
            {"label": "tooth abrasion", "confidence": 0.947}
          ],
          "square_crop_path": "images/原始照片_tooth_2.png"
        },
        {
          "tooth_fdi": "21",
          "diseases": [
            {"label": "tooth abrasion", "confidence": 0.961},
            {"label": "tooth abrasion", "confidence": 0.904}
          ],
          "square_crop_path": "images/原始照片_tooth_9.png"
        },
        {
          "tooth_fdi": "16",
          "diseases": [
            {"label": "tooth abrasion", "confidence": 0.951}
          ],
          "square_crop_path": "images/原始照片_tooth_6.png"
        },
        {
          "tooth_fdi": "17",
          "diseases": [
            {"label": "general_caries", "confidence": 0.984},
            {"label": "tooth abrasion", "confidence": 0.927}
          ],
          "square_crop_path": "images/原始照片_tooth_7.png"
        },
        {
          "tooth_fdi": "24",
          "diseases": [
            {"label": "general_caries", "confidence": 0.984},
            {"label": "tooth abrasion", "confidence": 0.947}
          ],
          "square_crop_path": "images/原始照片_tooth_12.png"
        },
        {
          "tooth_fdi": "22",
          "diseases": [
            {"label": "twisted tooth", "confidence": 0.934},
            {"label": "tooth abrasion", "confidence": 0.969},
            {"label": "tooth abrasion", "confidence": 0.957}
          ],
          "square_crop_path": "images/原始照片_tooth_10.png"
        }
      ]
    };

    // FDI牙齿编号到中文位置的映射
    const FDI_TO_POSITION = {
      // 右上 (11-18)
      '11': '右上中切牙', '12': '右上侧切牙', '13': '右上尖牙', '14': '右上第一前磨牙', '15': '右上第二前磨牙', '16': '右上第一磨牙', '17': '右上第二磨牙', '18': '右上第三磨牙',
      // 左上 (21-28)
      '21': '左上中切牙', '22': '左上侧切牙', '23': '左上尖牙', '24': '左上第一前磨牙', '25': '左上第二前磨牙', '26': '左上第一磨牙', '27': '左上第二磨牙', '28': '左上第三磨牙',
      // 左下 (31-38)
      '31': '左下中切牙', '32': '左下侧切牙', '33': '左下尖牙', '34': '左下第一前磨牙', '35': '左下第二前磨牙', '36': '左下第一磨牙', '37': '左下第二磨牙', '38': '左下第三磨牙',
      // 右下 (41-48)
      '41': '右下中切牙', '42': '右下侧切牙', '43': '右下尖牙', '44': '右下第一前磨牙', '45': '右下第二前磨牙', '46': '右下第一磨牙', '47': '右下第二磨牙', '48': '右下第三磨牙',
      // 乳牙编号 (51-85)
      '51': '右上乳中切牙', '52': '右上乳侧切牙', '53': '右上乳尖牙', '54': '右上第一乳磨牙', '55': '右上第二乳磨牙',
      '61': '左上乳中切牙', '62': '左上乳侧切牙', '63': '左上乳尖牙', '64': '左上第一乳磨牙', '65': '左上第二乳磨牙',
      '71': '左下乳中切牙', '72': '左下乳侧切牙', '73': '左下乳尖牙', '74': '左下第一乳磨牙', '75': '左下第二乳磨牙',
      '81': '右下乳中切牙', '82': '右下乳侧切牙', '83': '右下乳尖牙', '84': '右下第一乳磨牙', '85': '右下第二乳磨牙'
    };

    // 疾病类型中文映射
    const DISEASE_NAMES = {
      'tooth abrasion': '磨损',
      'general_caries': '龋齿',
      'twisted tooth': '扭转',
      'crown': '全冠',
      'tilted tooth': '倾斜',
      'gingivitis': '牙龈炎',
      'periodontitis': '牙周炎'
    };

    // 加载result.json数据
    let reportData = null;
    
    async function loadReportData() {
      try {
        // 添加时间戳参数防止缓存
        const timestamp = new Date().getTime();
        const response = await fetch(`result.json?t=${timestamp}`, {
          cache: 'no-cache',
          headers: {
            'Cache-Control': 'no-cache'
          }
        });
        reportData = await response.json();
        console.log('成功加载result.json:', reportData);
        console.log('第一个牙齿的图片路径:', reportData.diseased_teeth[0]?.square_crop_path);
      } catch (error) {
        console.error('无法加载result.json:', error);
        console.log('使用嵌入的默认数据');
        // 使用嵌入的默认数据
        reportData = EMBEDDED_DATA;
      }
      // 无论是否成功加载，都生成内容
      generateDynamicContent();
    }

    // 简化的牙齿编号到FDI的映射（如果使用的是简化编号）
    const SIMPLE_TO_FDI = {
      '1': '11', '2': '12', '3': '13', '4': '14', '5': '15', '6': '16', '7': '17', '8': '18',
      '9': '21', '10': '22', '11': '23', '12': '24', '13': '25', '14': '26', '15': '27', '16': '28',
      '17': '31', '18': '32', '19': '33', '20': '34', '21': '35', '22': '36', '23': '37', '24': '38',
      '25': '41', '26': '42', '27': '43', '28': '44', '29': '45', '30': '46', '31': '47', '32': '48'
    };

    // 获取牙齿位置描述
    function getToothPosition(fdi) {
      // 先尝试直接查找
      if (FDI_TO_POSITION[fdi]) {
        return FDI_TO_POSITION[fdi];
      }
      // 如果是简化编号，转换为FDI
      const fdiNum = SIMPLE_TO_FDI[fdi] || fdi;
      return FDI_TO_POSITION[fdiNum] || `${fdi}号牙`;
    }
    
    // 获取牙齿所在的象限和位置
    function getToothQuadrant(fdi) {
      const num = parseInt(fdi);
      if (num >= 1 && num <= 8) return { quadrant: 'upper-right', position: num, display: num };
      if (num >= 9 && num <= 16) return { quadrant: 'upper-left', position: 17 - num, display: num };
      if (num >= 17 && num <= 24) return { quadrant: 'lower-left', position: num - 16, display: num };
      if (num >= 25 && num <= 32) return { quadrant: 'lower-right', position: 33 - num, display: num };
      return { quadrant: 'unknown', position: 0, display: fdi };
    }

    // 生成病因分析内容
    function generateCauseAnalysis() {
      if (!reportData || !reportData.diseased_teeth) return {};

      // 按疾病类型分组
      const diseaseGroups = {};
      
      reportData.diseased_teeth.forEach(tooth => {
        const fdi = tooth.tooth_fdi;
        const position = getToothPosition(fdi);
        
        tooth.diseases.forEach(disease => {
          const diseaseName = DISEASE_NAMES[disease.label] || disease.label;
          
          if (!diseaseGroups[disease.label]) {
            diseaseGroups[disease.label] = {
              name: diseaseName,
              teeth: [],
              images: []
            };
          }
          
          // 添加牙齿信息
          const toothInfo = {
            fdi: fdi,
            position: position,
            image: tooth.square_crop_path || null
          };
          
          // 检查是否已存在该牙齿
          const existingTooth = diseaseGroups[disease.label].teeth.find(t => t.fdi === fdi);
          if (!existingTooth) {
            diseaseGroups[disease.label].teeth.push(toothInfo);
            if (toothInfo.image && !diseaseGroups[disease.label].images.includes(toothInfo.image)) {
              diseaseGroups[disease.label].images.push(toothInfo.image);
            }
          } else if (toothInfo.image && !diseaseGroups[disease.label].images.includes(toothInfo.image)) {
            // 如果牙齿已存在但图片不同，也添加图片
            diseaseGroups[disease.label].images.push(toothInfo.image);
          }
        });
      });

      return diseaseGroups;
    }

    // 生成动态内容
    function generateDynamicContent() {
      console.log('开始生成动态内容...');
      console.log('reportData:', reportData);
      
      const diseaseGroups = generateCauseAnalysis();
      console.log('疾病分组:', diseaseGroups);
      
      updateCauseAnalysisSection(diseaseGroups);
      console.log('病因分析部分已更新');
      
      updateToothDistributionChart();
      console.log('牙齿分布图已更新');
      
      updateTreatmentChart();
      console.log('治疗方案图已更新');
      
      updateTreatmentRecommendations(diseaseGroups);
      console.log('治疗方案与建议已更新');
      
      updateSummaryStats();
      console.log('统计数据已更新');
    }

    // 更新统计数字和首页内容
    function updateSummaryStats() {
      if (!reportData || !reportData.diseased_teeth) return;
      
      // 统计问题牙齿数量和病变总数
      const problemTeeth = new Set();
      let totalProblems = 0;
      const diseaseCount = {};
      
      reportData.diseased_teeth.forEach(tooth => {
        problemTeeth.add(tooth.tooth_fdi);
        tooth.diseases.forEach(disease => {
          totalProblems++;
          const diseaseName = DISEASE_NAMES[disease.label] || disease.label;
          if (!diseaseCount[diseaseName]) {
            diseaseCount[diseaseName] = { count: 0, teeth: new Set() };
          }
          diseaseCount[diseaseName].count++;
          diseaseCount[diseaseName].teeth.add(tooth.tooth_fdi);
        });
      });
      
      // 计算健康评分（100分制，根据问题数量）
      const healthScore = Math.max(50, 100 - (problemTeeth.size * 3) - (totalProblems * 1));
      
      // 更新封面统计数据
      const coverProblemTeeth = document.getElementById('cover-problem-teeth');
      const coverTotalProblems = document.getElementById('cover-total-problems');
      const coverHealthScore = document.getElementById('cover-health-score');
      
      if (coverProblemTeeth) coverProblemTeeth.textContent = problemTeeth.size;
      if (coverTotalProblems) coverTotalProblems.textContent = totalProblems;
      if (coverHealthScore) coverHealthScore.textContent = healthScore;
      
      // 更新内页统计数据
      const pageProblemTeeth = document.getElementById('page-problem-teeth');
      const pageTotalProblems = document.getElementById('page-total-problems');
      const pageHealthScore = document.getElementById('page-health-score');
      
      if (pageProblemTeeth) pageProblemTeeth.textContent = problemTeeth.size;
      if (pageTotalProblems) pageTotalProblems.textContent = totalProblems;
      if (pageHealthScore) pageHealthScore.textContent = healthScore;
      
      // 更新主要发现
      const mainFindings = document.getElementById('main-findings');
      if (mainFindings && diseaseCount) {
        let html = '';
        Object.keys(diseaseCount).forEach(diseaseName => {
          const data = diseaseCount[diseaseName];
          const teethList = Array.from(data.teeth).sort((a, b) => a - b).join(', ');
          html += `<li>检测到 <strong>${diseaseName}</strong> ${data.count} 处（涉及 ${teethList} 号牙）</li>`;
        });
        mainFindings.innerHTML = html || '<li>未检测到明显问题</li>';
      }
      
      // 生成个性化评估
      updatePersonalizedAssessment(diseaseCount, problemTeeth);
      
      // 生成专属建议
      updateCustomAdvice(diseaseCount, problemTeeth);
    }
    
    // 更新个性化评估
    function updatePersonalizedAssessment(diseaseCount, problemTeeth) {
      const assessmentEl = document.getElementById('personalized-assessment');
      if (!assessmentEl) return;
      
      let assessment = '<strong>个性化评估：</strong>根据您的口腔检测结果，';
      const diseases = Object.keys(diseaseCount);
      
      if (diseases.length === 0) {
        assessment += '未检测到明显的口腔问题，您的口腔健康状况良好。请继续保持良好的口腔卫生习惯。';
      } else {
        const parts = [];
        
        // 龋齿
        if (diseaseCount['龋齿']) {
          const teethList = Array.from(diseaseCount['龋齿'].teeth).sort((a, b) => a - b).join('号、');
          parts.push(`发现您的${teethList}号牙存在龋齿问题，这可能与日常清洁不够彻底有关，尤其是后牙区域容易积聚食物残渣`);
        }
        
        // 磨损
        if (diseaseCount['磨损']) {
          const teethList = Array.from(diseaseCount['磨损'].teeth).sort((a, b) => a - b).join('、');
          parts.push(`您有${diseaseCount['磨损'].count}处牙齿磨损（${teethList}号牙），主要集中在前牙和后牙区域，这通常与夜间磨牙、咬合力度过大或饮食习惯相关`);
        }
        
        // 扭转/倾斜
        if (diseaseCount['扭转'] || diseaseCount['倾斜']) {
          const twistedTeeth = diseaseCount['扭转'] ? Array.from(diseaseCount['扭转'].teeth) : [];
          const tiltedTeeth = diseaseCount['倾斜'] ? Array.from(diseaseCount['倾斜'].teeth) : [];
          const allTeeth = [...twistedTeeth, ...tiltedTeeth].sort((a, b) => a - b).join('号、');
          parts.push(`${allTeeth}号牙的排列异常会影响整体美观和咬合功能`);
        }
        
        // 牙龈炎/牙周炎
        if (diseaseCount['牙龈炎'] || diseaseCount['牙周炎']) {
          parts.push('检测到牙龈/牙周问题，需要及时进行专业治疗并加强口腔卫生');
        }
        
        assessment += parts.join('。同时，') + '。';
      }
      
      assessmentEl.innerHTML = assessment;
    }
    
    // 更新专属建议
    function updateCustomAdvice(diseaseCount, problemTeeth) {
      const adviceEl = document.getElementById('custom-advice');
      if (!adviceEl) return;
      
      let advice = '<strong>专属建议：</strong>';
      const advices = [];
      
      if (diseaseCount['龋齿']) {
        advices.push('建议您优先处理龋齿问题，避免继续发展导致牙髓炎');
      }
      
      if (diseaseCount['磨损']) {
        advices.push('对于磨损严重的牙齿，建议考虑佩戴夜间咬合垫以减少进一步损伤，同时调整饮食习惯，避免过硬食物');
      }
      
      if (diseaseCount['扭转'] || diseaseCount['倾斜']) {
        advices.push('牙齿排列异常可以通过正畸治疗改善，不仅提升美观度，还能改善咀嚼功能');
      }
      
      if (diseaseCount['牙龈炎'] || diseaseCount['牙周炎']) {
        advices.push('需要进行专业的牙周治疗，并加强日常口腔卫生');
      }
      
      // 通用建议
      advices.push('建议每半年进行一次专业洁牙，并使用含氟牙膏配合正确的巴氏刷牙法进行日常护理');
      
      advice += advices.join('。') + '。';
      adviceEl.innerHTML = advice;
    }

    // 更新治疗方案与建议（个性化定制）
    function updateTreatmentRecommendations(diseaseGroups) {
      const section = document.getElementById('treatment-recommendations-section');
      if (!section) {
        console.error('找不到treatment-recommendations-section元素');
        return;
      }

      if (!diseaseGroups || Object.keys(diseaseGroups).length === 0) {
        section.innerHTML = '<p style="color: var(--text-light); padding: 20px;">未检测到需要治疗的问题。</p>';
        return;
      }

      let html = '';
      const diseaseTypes = Object.keys(diseaseGroups);

      // 根据疾病类型决定需要显示的治疗方案
      const needsCleaning = true; // 所有人都建议洗牙
      const needsFilling = diseaseTypes.includes('general_caries');
      const needsRootCanal = diseaseTypes.includes('general_caries'); // 龋齿可能需要根管治疗
      const needsAbrasionTreatment = diseaseTypes.includes('tooth abrasion');
      const needsOrthodontics = diseaseTypes.includes('twisted tooth') || diseaseTypes.includes('tilted tooth');

      // 洗牙（所有人都需要）
      if (needsCleaning) {
        html += getTreatmentTemplate('cleaning');
      }

      // 补牙（有龋齿的需要）
      if (needsFilling) {
        html += getTreatmentTemplate('filling');
      }

      // 根管治疗（严重龋齿需要）
      if (needsRootCanal) {
        html += getTreatmentTemplate('rootCanal');
      }

      // 牙磨损修复（有磨损的需要）
      if (needsAbrasionTreatment) {
        html += getTreatmentTemplate('abrasion');
      }

      // 正畸治疗（有扭转/倾斜的需要）
      if (needsOrthodontics) {
        html += getTreatmentTemplate('orthodontics');
      }

      section.innerHTML = html;
    }

    // 获取治疗方案模板
    function getTreatmentTemplate(type) {
      const templates = {
        'cleaning': `
          <div class="treatment-item">
            <h4>口腔卫生 - 洗牙治疗</h4>
            <div class="treatment-subsection">
              <h5>为什么需要洗牙？</h5>
              <ul>
                <li>洗牙（洁牙）是去除牙齿表面和牙龈边缘的牙菌斑、牙结石的专业治疗方法。</li>
                <li>即使每天认真刷牙，仍会有30-40%的区域难以清洁，这些区域容易形成牙菌斑和牙结石。</li>
                <li>牙菌斑和牙结石是导致牙龈炎、牙周炎的主要原因，定期洗牙可以有效预防这些疾病。</li>
                <li>洗牙可以清除牙齿表面的色素沉着，让牙齿恢复自然光泽。</li>
                <li>早期发现口腔问题，洗牙过程中医生可以发现肉眼难以察觉的早期龋齿、牙龈问题等。</li>
              </ul>
            </div>
            <div class="treatment-subsection">
              <h5>洗牙流程</h5>
              <div class="treatment-step">
                <strong>1. 口腔检查</strong>
                <div>医生先进行全面的口腔检查，了解您的口腔健康状况，评估洗牙的难度和注意事项。</div>
              </div>
              <div class="treatment-step">
                <strong>2. 超声波洁治</strong>
                <div>使用超声波洁牙机去除牙齿表面的牙结石和牙菌斑，这是洗牙的主要步骤。</div>
              </div>
              <div class="treatment-step">
                <strong>3. 喷砂抛光</strong>
                <div>对于色素沉着较严重的牙齿，使用喷砂技术进一步清洁，然后进行抛光处理。</div>
              </div>
              <div class="treatment-step">
                <strong>4. 牙周冲洗</strong>
                <div>使用专业的冲洗液清洁牙龈沟，去除残留的细菌和污垢。</div>
              </div>
              <div class="treatment-step">
                <strong>5. 氟化物涂布</strong>
                <div>在牙齿表面涂布氟化物，增强牙齿的抗龋能力（可选，根据医生建议）。</div>
              </div>
            </div>
            <div class="treatment-subsection">
              <h5>洗牙注意事项</h5>
              <ul>
                <li>洗牙后24小时内避免进食过冷、过热、过酸、过甜的食物。</li>
                <li>洗牙后可能出现轻微的牙齿敏感，这是正常现象，通常1-2天会自行缓解。</li>
                <li>洗牙后一周内避免使用硬毛牙刷，建议使用软毛牙刷。</li>
                <li>洗牙后注意保持口腔卫生，每天至少刷牙两次，使用牙线清洁牙间隙。</li>
                <li>建议每6个月进行一次专业洗牙，保持口腔健康。</li>
                <li>如有牙龈出血、疼痛等不适，及时联系医生。</li>
              </ul>
            </div>
            <div class="treatment-subsection">
              <h5>常见问题</h5>
              <div class="qa-item">
                <strong>Q: 洗牙会伤害牙齿吗？</strong>
                <div>A: 不会。专业的洗牙操作不会伤害牙齿，反而有助于维护牙齿健康。超声波洁牙机的工作原理是通过高频振动去除牙结石，不会损伤牙釉质。</div>
              </div>
              <div class="qa-item">
                <strong>Q: 洗牙后牙齿会变白吗？</strong>
                <div>A: 洗牙主要去除牙菌斑和牙结石，可以恢复牙齿的自然颜色，但不会改变牙齿本身的颜色。如果想要美白效果，需要单独进行牙齿美白治疗。</div>
              </div>
              <div class="qa-item">
                <strong>Q: 多久洗一次牙合适？</strong>
                <div>A: 一般建议每6个月洗一次牙。如果口腔卫生状况较差，或者有牙周疾病，可能需要更频繁的洗牙，具体频率应听从医生的建议。</div>
              </div>
            </div>
          </div>
        `,
        'filling': `
          <div class="treatment-item">
            <h4>龋齿 - 补牙治疗</h4>
            <div class="treatment-subsection">
              <h5>为什么需要补牙？</h5>
              <ul>
                <li>龋齿（蛀牙）是细菌侵蚀牙齿硬组织导致的疾病，如果不及时治疗，龋洞会不断扩大。</li>
                <li>早期补牙可以阻止龋齿进一步发展，保护牙髓（牙神经），避免需要进行根管治疗。</li>
                <li>补牙可以恢复牙齿的形态和功能，防止食物嵌塞，避免影响咀嚼功能。</li>
                <li>及时补牙可以防止龋齿扩散到邻牙，保护整体口腔健康。</li>
                <li>补牙材料可以封闭龋洞，防止细菌再次侵入，保护牙齿健康。</li>
              </ul>
            </div>
            <div class="treatment-subsection">
              <h5>补牙流程</h5>
              <div class="treatment-step">
                <strong>1. 局部麻醉</strong>
                <div>在需要治疗的牙齿周围注射局部麻醉剂，确保治疗过程无痛（根据龋洞深度决定是否需要麻醉）。</div>
              </div>
              <div class="treatment-step">
                <strong>2. 去除龋坏组织</strong>
                <div>使用高速钻头去除牙齿上的龋坏组织，清理干净龋洞，为填充做准备。</div>
              </div>
              <div class="treatment-step">
                <strong>3. 洞形制备</strong>
                <div>将龋洞制备成适合填充的形状，确保补牙材料能够牢固地固定在牙齿上。</div>
              </div>
              <div class="treatment-step">
                <strong>4. 消毒处理</strong>
                <div>对清理后的龋洞进行消毒处理，杀灭残留的细菌，防止再次感染。</div>
              </div>
              <div class="treatment-step">
                <strong>5. 填充材料</strong>
                <div>选择合适的补牙材料（如复合树脂、玻璃离子等）填充龋洞，恢复牙齿形态。</div>
              </div>
              <div class="treatment-step">
                <strong>6. 修整抛光</strong>
                <div>填充完成后，修整补牙材料的形态，使其与牙齿自然贴合，然后进行抛光处理。</div>
              </div>
            </div>
            <div class="treatment-subsection">
              <h5>补牙后注意事项</h5>
              <ul>
                <li>补牙后2小时内避免进食，让补牙材料充分固化。</li>
                <li>补牙后24小时内避免用补牙侧咀嚼硬物，避免过冷、过热、过甜的食物。</li>
                <li>补牙后可能出现轻微的牙齿敏感，这是正常现象，通常几天内会自行缓解。</li>
                <li>保持良好的口腔卫生，每天至少刷牙两次，使用含氟牙膏。</li>
                <li>定期复查，检查补牙材料的完整性，如有脱落或不适，及时就医。</li>
                <li>避免用牙齿咬硬物（如开瓶盖、咬坚果等），保护补牙材料。</li>
              </ul>
            </div>
            <div class="treatment-subsection">
              <h5>常见问题</h5>
              <div class="qa-item">
                <strong>Q: 补牙材料有哪些？哪种最好？</strong>
                <div>A: 常见的补牙材料有复合树脂、玻璃离子、银汞合金等。复合树脂是目前最常用的材料，颜色接近牙齿，美观性好，强度也足够。具体选择哪种材料应根据龋洞位置、大小和患者需求来决定。</div>
              </div>
              <div class="qa-item">
                <strong>Q: 补牙后还会再蛀吗？</strong>
                <div>A: 如果补牙后保持良好的口腔卫生，定期复查，一般不会再次发生龋齿。但如果口腔卫生不良，补牙材料边缘可能出现新的龋坏，需要及时处理。</div>
              </div>
              <div class="qa-item">
                <strong>Q: 补牙需要多长时间？</strong>
                <div>A: 简单的补牙通常需要30-60分钟。如果龋洞较大或位置较复杂，可能需要更长时间。具体时间取决于龋齿的严重程度和治疗难度。</div>
              </div>
            </div>
          </div>
        `,
        'rootCanal': `
          <div class="treatment-item">
            <h4>严重龋齿 - 根管治疗</h4>
            <div class="treatment-subsection">
              <h5>为什么需要根管治疗？</h5>
              <ul>
                <li>根管治疗是当龋齿已经感染到牙髓（牙神经）时，清除感染的牙髓组织，保留患牙的治疗方法。</li>
                <li>如果不进行根管治疗，感染会扩散到牙根周围，可能导致牙根尖周炎，甚至需要拔牙。</li>
                <li>根管治疗可以消除疼痛，保留患牙，避免拔牙后需要种植牙或镶牙。</li>
                <li>根管治疗后，患牙可以继续使用，维持正常的咀嚼功能。</li>
                <li>根管治疗是治疗牙髓炎、牙髓坏死最有效的方法，成功率高达90%以上。</li>
              </ul>
            </div>
            <div class="treatment-subsection">
              <h5>根管治疗流程</h5>
              <div class="treatment-step">
                <strong>1. 局部麻醉</strong>
                <div>在患牙周围注射局部麻醉剂，确保治疗过程无痛。</div>
              </div>
              <div class="treatment-step">
                <strong>2. 开髓</strong>
                <div>在牙齿上开一个小洞，暴露牙髓腔，为清理做准备。</div>
              </div>
              <div class="treatment-step">
                <strong>3. 清理根管</strong>
                <div>使用专业的器械清除感染的牙髓组织，彻底清理根管内的细菌和坏死组织。</div>
              </div>
              <div class="treatment-step">
                <strong>4. 根管消毒</strong>
                <div>使用消毒药物对根管进行消毒，杀灭残留的细菌，防止再次感染。</div>
              </div>
              <div class="treatment-step">
                <strong>5. 根管填充</strong>
                <div>在根管清理干净后，使用专业的填充材料（如牙胶尖）填充根管，封闭根管系统。</div>
              </div>
              <div class="treatment-step">
                <strong>6. 牙冠修复</strong>
                <div>根管治疗后，牙齿变脆，需要进行牙冠修复（做牙套）保护牙齿，恢复功能。</div>
              </div>
            </div>
            <div class="treatment-subsection">
              <h5>根管治疗后注意事项</h5>
              <ul>
                <li>根管治疗后24小时内避免用患侧咀嚼，让填充材料充分固化。</li>
                <li>治疗后可能出现轻微的疼痛或不适，这是正常现象，通常3-5天会自行缓解。</li>
                <li>如果疼痛严重，可以按医生建议服用止痛药。</li>
                <li>根管治疗后必须进行牙冠修复（做牙套），保护脆弱的牙齿，防止牙齿断裂。</li>
                <li>保持良好的口腔卫生，定期复查，检查根管治疗的效果。</li>
                <li>避免用患牙咬硬物，保护修复后的牙齿。</li>
                <li>根管治疗后的牙齿可能变色，这是正常现象，可以通过牙冠修复改善外观。</li>
              </ul>
            </div>
            <div class="treatment-subsection">
              <h5>常见问题</h5>
              <div class="qa-item">
                <strong>Q: 根管治疗疼吗？</strong>
                <div>A: 根管治疗在局部麻醉下进行，治疗过程中不会感到疼痛。治疗后可能出现轻微不适，但通常可以忍受，必要时可以服用止痛药。</div>
              </div>
              <div class="qa-item">
                <strong>Q: 根管治疗后一定要做牙冠吗？</strong>
                <div>A: 强烈建议做牙冠。根管治疗后的牙齿失去牙髓的营养供应，变得脆弱，容易断裂。牙冠可以保护牙齿，恢复功能，延长牙齿使用寿命。</div>
              </div>
              <div class="qa-item">
                <strong>Q: 根管治疗需要几次？</strong>
                <div>A: 根管治疗通常需要2-4次就诊，具体次数取决于感染的严重程度和根管的复杂程度。每次治疗间隔1-2周。</div>
              </div>
              <div class="qa-item">
                <strong>Q: 根管治疗的成功率是多少？</strong>
                <div>A: 根管治疗的成功率高达90%以上。治疗成功的关键在于彻底清理根管、完善的填充和及时的牙冠修复。</div>
              </div>
            </div>
          </div>
        `,
        'abrasion': getTreatmentAbrasionTemplate(),
        'orthodontics': getTreatmentOrthodonticsTemplate()
      };

      return templates[type] || '';
    }

    // 牙磨损治疗模板
    function getTreatmentAbrasionTemplate() {
      return `
        <div class="treatment-item">
          <h4>牙磨损 - 修复治疗</h4>
          <div class="treatment-subsection">
            <h5>为什么需要治疗牙磨损？</h5>
            <ul>
              <li>严重的牙磨损会导致牙齿敏感、疼痛，影响咀嚼功能。</li>
              <li>牙磨损可能暴露牙本质，导致牙齿对冷热刺激敏感。</li>
              <li>严重的磨损可能影响牙齿的美观和功能。</li>
              <li>及时治疗可以防止磨损进一步加重，保护牙齿健康。</li>
              <li>长期磨损可能导致牙髓暴露，需要进行根管治疗。</li>
            </ul>
          </div>
          <div class="treatment-subsection">
            <h5>治疗方法</h5>
            <div class="treatment-step">
              <strong>1. 轻度磨损</strong>
              <div>使用脱敏牙膏，避免过冷过热食物，定期复查。可使用含氟漱口水增强牙齿抗敏能力。</div>
            </div>
            <div class="treatment-step">
              <strong>2. 中度磨损</strong>
              <div>进行牙齿修复，使用复合树脂填充磨损区域，恢复牙齿形态和功能。</div>
            </div>
            <div class="treatment-step">
              <strong>3. 重度磨损</strong>
              <div>可能需要进行牙冠修复（全瓷冠或烤瓷冠），全面保护牙齿，恢复咀嚼功能。</div>
            </div>
            <div class="treatment-step">
              <strong>4. 夜磨牙治疗</strong>
              <div>如有夜磨牙习惯，需要定制专业的咬合垫（夜磨牙保护牙套），在睡眠时佩戴，保护牙齿免受进一步磨损。</div>
            </div>
          </div>
          <div class="treatment-subsection">
            <h5>治疗后注意事项</h5>
            <ul>
              <li>修复后24小时内避免进食过硬食物，让修复材料充分固化。</li>
              <li>改善刷牙习惯，使用软毛牙刷，避免横向用力刷牙。</li>
              <li>减少酸性食物和饮料的摄入，保护牙齿。</li>
              <li>如有夜磨牙习惯，坚持佩戴防护牙套。</li>
              <li>定期复查，检查修复材料的完整性和磨损情况。</li>
            </ul>
          </div>
          <div class="treatment-subsection">
            <h5>常见问题</h5>
            <div class="qa-item">
              <strong>Q: 牙齿磨损修复后还会再磨损吗？</strong>
              <div>A: 如果不改变导致磨损的原因（如刷牙方式、夜磨牙习惯），修复后的牙齿仍可能继续磨损。建议找出磨损原因并进行针对性预防。</div>
            </div>
            <div class="qa-item">
              <strong>Q: 夜磨牙保护牙套需要一直戴吗？</strong>
              <div>A: 夜磨牙保护牙套通常只需要在睡眠时佩戴。如果夜磨牙习惯持续存在，建议长期使用以保护牙齿。</div>
            </div>
            <div class="qa-item">
              <strong>Q: 牙齿磨损修复需要多长时间？</strong>
              <div>A: 轻度磨损的修复通常需要30-60分钟。如果需要牙冠修复，可能需要2-3次就诊，总共1-2周时间。</div>
            </div>
          </div>
        </div>
      `;
    }

    // 正畸治疗模板
    function getTreatmentOrthodonticsTemplate() {
      return `
        <div class="treatment-item">
          <h4>牙齿扭转/倾斜 - 正畸治疗</h4>
          <div class="treatment-subsection">
            <h5>为什么需要正畸治疗？</h5>
            <ul>
              <li>牙齿扭转或倾斜会影响美观和功能，影响自信心和社交。</li>
              <li>排列不齐的牙齿难以清洁，容易导致龋齿和牙周疾病。</li>
              <li>正畸治疗可以改善牙齿排列，提高口腔健康水平。</li>
              <li>改善咬合关系，减少颞下颌关节问题。</li>
              <li>预防牙齿异常磨损，保护牙齿长期健康。</li>
            </ul>
          </div>
          <div class="treatment-subsection">
            <h5>正畸治疗流程</h5>
            <div class="treatment-step">
              <strong>1. 初诊检查</strong>
              <div>进行全面的口腔检查，拍摄X光片和口腔照片，取牙模，评估牙齿排列情况和咬合关系。</div>
            </div>
            <div class="treatment-step">
              <strong>2. 制定方案</strong>
              <div>根据检查结果，正畸医生制定个性化的矫正方案，包括矫正方式、预计时间和费用。</div>
            </div>
            <div class="treatment-step">
              <strong>3. 开始矫正</strong>
              <div>安装矫治器（传统托槽、自锁托槽或隐形矫治器），开始牙齿移动过程。</div>
            </div>
            <div class="treatment-step">
              <strong>4. 定期复诊</strong>
              <div>每4-6周复诊一次，调整矫治力，监测牙齿移动进度，及时处理不适。</div>
            </div>
            <div class="treatment-step">
              <strong>5. 拆除矫治器</strong>
              <div>达到预期效果后，拆除矫治器，进行牙齿清洁和抛光。</div>
            </div>
            <div class="treatment-step">
              <strong>6. 保持期</strong>
              <div>佩戴保持器（通常需要1-2年），防止牙齿复发，定期复查。</div>
            </div>
          </div>
          <div class="treatment-subsection">
            <h5>矫正方式选择</h5>
            <ul>
              <li><strong>传统金属托槽：</strong>经济实惠，矫正力量强，适合各种复杂情况。</li>
              <li><strong>陶瓷托槽：</strong>美观度较高，颜色接近牙齿，但价格稍高。</li>
              <li><strong>自锁托槽：</strong>减少摩擦力，缩短治疗时间，复诊间隔更长。</li>
              <li><strong>隐形矫治器：</strong>美观、舒适、可摘戴，适合轻中度矫正，价格较高。</li>
              <li><strong>舌侧矫治器：</strong>完全隐形，但舒适度较低，价格最高。</li>
            </ul>
          </div>
          <div class="treatment-subsection">
            <h5>正畸治疗注意事项</h5>
            <ul>
              <li>矫正期间保持良好的口腔卫生，每次进食后刷牙，使用牙线和牙间刷。</li>
              <li>避免进食过硬、过粘的食物（如坚果、口香糖、年糕等）。</li>
              <li>按时复诊，不要自行调整或拆除矫治器。</li>
              <li>矫正初期可能出现牙齿酸痛，这是正常现象，通常3-5天会缓解。</li>
              <li>如有托槽脱落、钢丝刺激等情况，及时联系医生处理。</li>
              <li>保持期必须认真佩戴保持器，否则可能导致复发。</li>
            </ul>
          </div>
          <div class="treatment-subsection">
            <h5>常见问题</h5>
            <div class="qa-item">
              <strong>Q: 正畸治疗疼吗？</strong>
              <div>A: 矫正过程中会有轻微的酸痛感，尤其是刚戴矫治器或调整后的几天。这是正常的生理反应，通常可以忍受，必要时可以服用止痛药。</div>
            </div>
            <div class="qa-item">
              <strong>Q: 成年人还能做正畸吗？</strong>
              <div>A: 可以。只要牙周健康，任何年龄都可以进行正畸治疗。成年人矫正可能需要更长时间，但效果同样显著。</div>
            </div>
            <div class="qa-item">
              <strong>Q: 隐形矫治器和传统矫治器哪个好？</strong>
              <div>A: 各有优劣。隐形矫治器美观、舒适，但价格较高，适合轻中度矫正。传统矫治器适用范围更广，价格相对较低。具体选择应根据个人情况和医生建议决定。</div>
            </div>
            <div class="qa-item">
              <strong>Q: 矫正后牙齿会松动吗？</strong>
              <div>A: 矫正过程中牙齿会有轻微松动，这是正常的生理现象。矫正完成后，牙齿会重新稳固。只要保持良好的口腔卫生和定期复查，不会影响牙齿健康。</div>
            </div>
          </div>
        </div>
      `;
    }

    // 更新病因分析部分
    function updateCauseAnalysisSection(diseaseGroups) {
      const section = document.getElementById('cause-analysis-content');
      if (!section) {
        console.error('找不到cause-analysis-content元素');
        return;
      }

      if (!diseaseGroups || Object.keys(diseaseGroups).length === 0) {
        section.innerHTML = '<p style="color: var(--text-light); padding: 20px;">未检测到疾病问题。</p>';
        return;
      }

      console.log('开始更新病因分析，疾病组:', diseaseGroups);
      let html = '';
      
      Object.values(diseaseGroups).forEach(group => {
        // 生成问题描述列表
        const problemsList = group.teeth.map(t => {
          const toothData = reportData.diseased_teeth.find(tooth => tooth.tooth_fdi === t.fdi);
          if (!toothData) return '';
          
          const allDiseases = toothData.diseases
            .map(d => DISEASE_NAMES[d.label] || d.label)
            .filter((v, i, a) => a.indexOf(v) === i) // 去重
            .join('、');
          return `您的${t.fdi}号牙（${t.position}）有${allDiseases}`;
        }).filter(p => p).join('；');

        // 生成图片网格
        const imagesHtml = group.images.length > 0 
          ? group.images.map((img, idx) => {
              console.log(`生成图片: ${img}`);
              return `<div class="cause-image-item"><img src="${img}" alt="${group.name}示例${idx + 1}" loading="lazy" onerror="console.error('图片加载失败:', '${img}')"></div>`;
            }).join('')
          : '';

        html += `
          <div class="cause-item">
            <div class="cause-item-content">
              <h4>${group.name}</h4>
              <p class="cause-teeth"><strong>涉及牙齿：</strong>${problemsList}</p>
              <p class="cause-title"><strong>可能原因：</strong></p>
              <ul class="cause-list">
                ${getCauseReasons(group.name)}
              </ul>
              <p class="cause-title" style="margin-top: 12px;"><strong>${group.name === '扭转' ? '治疗' : '预防'}建议：</strong></p>
              <ul class="cause-list">
                ${getPreventionAdvice(group.name)}
              </ul>
            </div>
            ${imagesHtml ? `<div class="cause-item-thumbs">${imagesHtml}</div>` : ''}
          </div>
        `;
      });

      section.innerHTML = html;
    }

    // 获取病因原因
    function getCauseReasons(diseaseName) {
      const reasons = {
        '磨损': [
          '<li><strong>机械性磨损：</strong>刷牙方式不当（横向刷牙、用力过猛）、使用硬毛牙刷或磨料过多的牙膏</li>',
          '<li><strong>饮食习惯：</strong>频繁摄入酸性食物（如柑橘类水果、碳酸饮料）、硬质食物（如坚果、硬糖）</li>',
          '<li><strong>功能性磨损：</strong>夜磨牙或紧咬牙习惯，导致牙齿非正常接触和磨损</li>',
          '<li><strong>年龄因素：</strong>随着年龄增长，牙齿会出现生理性磨损，这是正常现象</li>'
        ],
        '龋齿': [
          '<li><strong>口腔卫生不良：</strong>牙菌斑堆积，未及时清除导致细菌产酸腐蚀牙釉质</li>',
          '<li><strong>饮食习惯：</strong>高糖饮食，频繁摄入含糖食物和饮料，为细菌提供营养</li>',
          '<li><strong>唾液因素：</strong>唾液分泌不足或成分异常，口腔自洁能力下降</li>',
          '<li><strong>牙齿结构：</strong>牙齿结构缺陷、发育不良或窝沟较深，容易藏匿食物残渣</li>'
        ],
        '扭转': [
          '<li><strong>遗传因素：</strong>家族性牙齿排列异常，遗传性颌骨发育问题</li>',
          '<li><strong>发育因素：</strong>乳牙早失或滞留导致恒牙萌出异常，牙弓空间不足</li>',
          '<li><strong>不良习惯：</strong>咬唇、吐舌、吮指等不良口腔习惯影响牙齿正常排列</li>',
          '<li><strong>颌骨发育：</strong>上下颌骨发育不协调，导致牙齿排列异常</li>'
        ]
      };
      return reasons[diseaseName]?.join('') || '<li>请咨询专业口腔医生了解具体原因</li>';
    }

    // 获取预防建议
    function getPreventionAdvice(diseaseName) {
      const advice = {
        '磨损': [
          '<li>采用正确的刷牙方法（建议使用巴氏刷牙法），避免横向用力刷牙</li>',
          '<li>选择软毛或超软毛牙刷，使用含氟牙膏</li>',
          '<li>减少酸性食物和饮料的摄入，进食后及时漱口</li>',
          '<li>如有夜磨牙习惯，建议佩戴防护牙套</li>'
        ],
        '龋齿': [
          '<li>保持良好的口腔卫生习惯，每天至少刷牙两次，使用牙线清洁牙间隙</li>',
          '<li>控制糖分摄入，减少含糖食物和饮料的摄入频率</li>',
          '<li>使用含氟牙膏，增强牙齿抗龋能力</li>',
          '<li>定期进行口腔检查和专业清洁（建议每6个月一次）</li>'
        ],
        '扭转': [
          '<li>咨询正畸专科医生，评估是否需要正畸治疗</li>',
          '<li>纠正不良口腔习惯，如咬唇、吐舌等</li>',
          '<li>根据具体情况，可能需要佩戴矫治器进行矫正</li>',
          '<li>定期复查，监测牙齿位置变化</li>'
        ]
      };
      return advice[diseaseName]?.join('') || '<li>请咨询专业口腔医生获取个性化建议</li>';
    }

    // 生成单颗牙齿的SVG路径（仿真牙齿形状 - 手机端平衡尺寸）
    function getToothPath(type, x, y, scale = 4.5) {
      const paths = {
        // 中切牙 - 椭圆形，略微垂直拉长
        'central-incisor': `M ${x} ${y-16*scale} Q ${x+10*scale} ${y-16*scale} ${x+10*scale} ${y} Q ${x+10*scale} ${y+16*scale} ${x} ${y+16*scale} Q ${x-10*scale} ${y+16*scale} ${x-10*scale} ${y} Q ${x-10*scale} ${y-16*scale} ${x} ${y-16*scale} Z`,
        // 侧切牙 - 稍小椭圆
        'lateral-incisor': `M ${x} ${y-15*scale} Q ${x+9*scale} ${y-15*scale} ${x+9*scale} ${y} Q ${x+9*scale} ${y+15*scale} ${x} ${y+15*scale} Q ${x-9*scale} ${y+15*scale} ${x-9*scale} ${y} Q ${x-9*scale} ${y-15*scale} ${x} ${y-15*scale} Z`,
        // 尖牙 - 椭圆形，顶部稍尖
        'canine': `M ${x} ${y-16*scale} Q ${x+11*scale} ${y-14*scale} ${x+11*scale} ${y} Q ${x+11*scale} ${y+14*scale} ${x} ${y+16*scale} Q ${x-11*scale} ${y+14*scale} ${x-11*scale} ${y} Q ${x-11*scale} ${y-14*scale} ${x} ${y-16*scale} Z`,
        // 第一前磨牙 - 圆润椭圆
        'first-premolar': `M ${x} ${y-14*scale} Q ${x+11*scale} ${y-14*scale} ${x+11*scale} ${y} Q ${x+11*scale} ${y+14*scale} ${x} ${y+14*scale} Q ${x-11*scale} ${y+14*scale} ${x-11*scale} ${y} Q ${x-11*scale} ${y-14*scale} ${x} ${y-14*scale} Z`,
        // 第二前磨牙 - 略大椭圆
        'second-premolar': `M ${x} ${y-15*scale} Q ${x+12*scale} ${y-15*scale} ${x+12*scale} ${y} Q ${x+12*scale} ${y+15*scale} ${x} ${y+15*scale} Q ${x-12*scale} ${y+15*scale} ${x-12*scale} ${y} Q ${x-12*scale} ${y-15*scale} ${x} ${y-15*scale} Z`,
        // 第一磨牙 - 大椭圆
        'first-molar': `M ${x} ${y-16*scale} Q ${x+13*scale} ${y-16*scale} ${x+13*scale} ${y} Q ${x+13*scale} ${y+16*scale} ${x} ${y+16*scale} Q ${x-13*scale} ${y+16*scale} ${x-13*scale} ${y} Q ${x-13*scale} ${y-16*scale} ${x} ${y-16*scale} Z`,
        // 第二磨牙 - 大椭圆
        'second-molar': `M ${x} ${y-16*scale} Q ${x+13*scale} ${y-16*scale} ${x+13*scale} ${y} Q ${x+13*scale} ${y+16*scale} ${x} ${y+16*scale} Q ${x-13*scale} ${y+16*scale} ${x-13*scale} ${y} Q ${x-13*scale} ${y-16*scale} ${x} ${y-16*scale} Z`,
        // 第三磨牙 - 稍小椭圆
        'third-molar': `M ${x} ${y-14*scale} Q ${x+12*scale} ${y-14*scale} ${x+12*scale} ${y} Q ${x+12*scale} ${y+14*scale} ${x} ${y+14*scale} Q ${x-12*scale} ${y+14*scale} ${x-12*scale} ${y} Q ${x-12*scale} ${y-14*scale} ${x} ${y-14*scale} Z`
      };
      return paths[type] || paths['first-molar'];
    }

    // 获取牙齿类型
    function getToothType(fdi) {
      const num = parseInt(fdi) % 10;
      const types = {
        1: 'central-incisor',
        2: 'lateral-incisor',
        3: 'canine',
        4: 'first-premolar',
        5: 'second-premolar',
        6: 'first-molar',
        7: 'second-molar',
        8: 'third-molar'
      };
      return types[num] || 'first-molar';
    }

    // 获取牙齿的镜像变换和基础FDI编号
    function getToothImageInfo(fdi) {
      const num = parseInt(fdi);
      
      // 只处理11-18号牙（对应图片编号11-18）
      if (num >= 11 && num <= 18) {
        // 上牙右侧（11-18）：使用对应编号的图片，无变换
        return { baseFdi: fdi, transform: '', useImage: true };
      } else if (num >= 21 && num <= 28) {
        // 上牙左侧（21-28）：使用对应右侧牙的图片，左右镜像
        const baseFdi = String(num - 10); // 21->11, 22->12, ...
        return { baseFdi: baseFdi, transform: 'scale(-1, 1)', useImage: true };
      } else if (num >= 31 && num <= 38) {
        // 下牙左侧（31-38）：使用对应上牙的图片，上下镜像
        const baseFdi = String(num - 20); // 31->11, 32->12, ...
        return { baseFdi: baseFdi, transform: 'scale(1, -1)', useImage: true };
      } else if (num >= 41 && num <= 48) {
        // 下牙右侧（41-48）：使用对应上牙的图片，上下+左右镜像
        const baseFdi = String(num - 30); // 41->11, 42->12, ...
        return { baseFdi: baseFdi, transform: 'scale(-1, -1)', useImage: true };
      }
      
      return { useImage: false };
    }

    // 更新牙齿分布图
    function updateToothDistributionChart() {
      if (!reportData || !reportData.diseased_teeth) {
        const container = document.getElementById('toothChartContainer');
        if (container) {
          container.innerHTML = '<div class="tooth-tooltip" id="toothTooltip"></div><div style="text-align: center; padding: 40px; color: var(--text-light);">暂无数据</div>';
        }
        return;
      }
      
      const container = document.getElementById('toothChartContainer');
      if (!container) return;

      // 构建牙齿数据映射
      const toothDataMap = {};
      reportData.diseased_teeth.forEach(tooth => {
        const fdi = tooth.tooth_fdi;
        const diseases = tooth.diseases.map(d => DISEASE_NAMES[d.label] || d.label);
        const uniqueDiseases = [...new Set(diseases)];
        
        if (!toothDataMap[fdi]) {
          toothDataMap[fdi] = {
            fdi: fdi,
            diseases: uniqueDiseases,
            count: uniqueDiseases.length
          };
        }
      });

      // 简化编号到FDI的映射
      const simpleToFDI = {
        '1': '11', '2': '12', '3': '13', '4': '14', '5': '15', '6': '16', '7': '17', '8': '18',
        '9': '21', '10': '22', '11': '23', '12': '24', '13': '25', '14': '26', '15': '27', '16': '28',
        '17': '31', '18': '32', '19': '33', '20': '34', '21': '35', '22': '36', '23': '37', '24': '38',
        '25': '41', '26': '42', '27': '43', '28': '44', '29': '45', '30': '46', '31': '47', '32': '48'
      };

      // 上颌牙齿排列（从右到左：18-11, 21-28）
      const upperTeeth = ['18', '17', '16', '15', '14', '13', '12', '11', '21', '22', '23', '24', '25', '26', '27', '28'];
      // 下颌牙齿排列（从右到左：48-41, 31-38）
      const lowerTeeth = ['48', '47', '46', '45', '44', '43', '42', '41', '31', '32', '33', '34', '35', '36', '37', '38'];

      // 生成上颌SVG (U型布局 - 超大画布，间距特别优化)
      let upperSvg = '<svg class="tooth-arch-svg" viewBox="0 -40 1100 650" xmlns="http://www.w3.org/2000/svg">';
      
      // 牙弓曲线已移除
      
        // 上颌牙齿位置（根据下颌对称，上下翻转）
        const upperPositions = [
          // 右侧 18-11 (从后向前，与下颌上下对称)
          {x: 130, y: 560}, {x: 145, y: 460}, {x: 160, y: 360}, {x: 180, y: 260},
          {x: 225, y: 170}, {x: 305, y: 95}, {x: 390, y: 40}, {x: 490, y: 10},
          // 左侧 21-28 (从前向后，完全镜像对称)
          {x: 610, y: 10}, {x: 710, y: 40}, {x: 795, y: 95}, {x: 875, y: 170},
          {x: 920, y: 260}, {x: 940, y: 360}, {x: 955, y: 460}, {x: 970, y: 560}
        ];
      
      upperTeeth.forEach((fdi, index) => {
        const pos = upperPositions[index];
        const simpleNum = Object.keys(simpleToFDI).find(k => simpleToFDI[k] === fdi);
        const data = toothDataMap[fdi] || (simpleNum ? toothDataMap[simpleNum] : null);
        
        let className = 'normal';
        let problemsText = '';
        
        if (data) {
          className = data.count > 1 ? 'multiple' : 'single';
          problemsText = data.diseases.join('、');
        }
        
        // 检查是否使用PNG图片
        const imageInfo = getToothImageInfo(fdi);
        
        if (imageInfo.useImage) {
          // 使用PNG图片显示牙齿
          const imageSize = 120; // 图片大小，可以根据实际PNG尺寸调整
          const imageX = pos.x - imageSize / 2;
          const imageY = pos.y - imageSize / 2;
          
          // 根据状态选择对应的PNG图片
          let imageFile = '';
          if (className === 'single') {
            imageFile = `images/Processed image/${imageInfo.baseFdi}/single.png`;
          } else if (className === 'multiple') {
            imageFile = `images/Processed image/${imageInfo.baseFdi}/multiple.png`;
          } else {
            imageFile = `images/Processed image/${imageInfo.baseFdi}/normal.png`;
          }
          
          // 应用镜像变换到图片上（数字不受影响）
          let imageTransform = '';
          if (imageInfo.transform) {
            imageTransform = `transform="translate(${pos.x}, ${pos.y}) ${imageInfo.transform} translate(${-pos.x}, ${-pos.y})"`;
          }
          
          upperSvg += `
            <g class="tooth-item" data-tooth="${fdi}" data-problems="${problemsText}">
              <image class="tooth-image" href="${imageFile}" x="${imageX}" y="${imageY}" width="${imageSize}" height="${imageSize}" preserveAspectRatio="xMidYMid meet" ${imageTransform}/>
              <text class="tooth-number-text" x="${pos.x}" y="${pos.y}">${fdi}</text>
            </g>
          `;
        } else {
          // 其他牙齿使用原有的SVG路径
          const toothType = getToothType(fdi);
          const toothPath = getToothPath(toothType, pos.x, pos.y);
          
          upperSvg += `
            <g class="tooth-item" data-tooth="${fdi}" data-problems="${problemsText}">
              <path class="tooth-shape ${className}" d="${toothPath}" />
              <text class="tooth-number-text" x="${pos.x}" y="${pos.y}">${fdi}</text>
            </g>
          `;
        }
      });
      
      upperSvg += '</svg>';

      // 生成下颌SVG (U型布局 - 超大画布，间距特别优化)
      let lowerSvg = '<svg class="tooth-arch-svg" viewBox="0 -40 1100 650" xmlns="http://www.w3.org/2000/svg">';
      
      // 牙弓曲线已移除
      
        // 下颌牙齿位置（侧后牙纵向排列，中切牙间距优化）
        const lowerPositions = [
          // 右侧 48-41 (与上颌11-18上下对称)
          {x: 130, y: 40}, {x: 145, y: 140}, {x: 160, y: 240}, {x: 180, y: 340},
          {x: 225, y: 430}, {x: 305, y: 505}, {x: 390, y: 560}, {x: 490, y: 590},
          // 左侧 31-38 (与上颌21-28上下对称)
          {x: 610, y: 590}, {x: 710, y: 560}, {x: 795, y: 505}, {x: 875, y: 430},
          {x: 920, y: 340}, {x: 940, y: 240}, {x: 955, y: 140}, {x: 970, y: 40}
        ];
      
      lowerTeeth.forEach((fdi, index) => {
        const pos = lowerPositions[index];
        const simpleNum = Object.keys(simpleToFDI).find(k => simpleToFDI[k] === fdi);
        const data = toothDataMap[fdi] || (simpleNum ? toothDataMap[simpleNum] : null);
        
        let className = 'normal';
        let problemsText = '';
        
        if (data) {
          className = data.count > 1 ? 'multiple' : 'single';
          problemsText = data.diseases.join('、');
        }
        
        // 检查是否使用PNG图片
        const imageInfo = getToothImageInfo(fdi);
        
        if (imageInfo.useImage) {
          // 使用PNG图片显示牙齿
          const imageSize = 120; // 图片大小，可以根据实际PNG尺寸调整
          const imageX = pos.x - imageSize / 2;
          const imageY = pos.y - imageSize / 2;
          
          // 根据状态选择对应的PNG图片
          let imageFile = '';
          if (className === 'single') {
            imageFile = `images/Processed image/${imageInfo.baseFdi}/single.png`;
          } else if (className === 'multiple') {
            imageFile = `images/Processed image/${imageInfo.baseFdi}/multiple.png`;
          } else {
            imageFile = `images/Processed image/${imageInfo.baseFdi}/normal.png`;
          }
          
          // 应用镜像变换到图片上（数字不受影响）
          let imageTransform = '';
          if (imageInfo.transform) {
            imageTransform = `transform="translate(${pos.x}, ${pos.y}) ${imageInfo.transform} translate(${-pos.x}, ${-pos.y})"`;
          }
          
          lowerSvg += `
            <g class="tooth-item" data-tooth="${fdi}" data-problems="${problemsText}">
              <image class="tooth-image" href="${imageFile}" x="${imageX}" y="${imageY}" width="${imageSize}" height="${imageSize}" preserveAspectRatio="xMidYMid meet" ${imageTransform}/>
              <text class="tooth-number-text" x="${pos.x}" y="${pos.y}">${fdi}</text>
            </g>
          `;
        } else {
          // 其他牙齿使用原有的SVG路径
          const toothType = getToothType(fdi);
          const toothPath = getToothPath(toothType, pos.x, pos.y);
          
          lowerSvg += `
            <g class="tooth-item" data-tooth="${fdi}" data-problems="${problemsText}">
              <path class="tooth-shape ${className}" d="${toothPath}" />
              <text class="tooth-number-text" x="${pos.x}" y="${pos.y}">${fdi}</text>
            </g>
          `;
        }
      });
      
      lowerSvg += '</svg>';

      // 组合HTML（删除标题，紧凑布局）
      let html = `
        <div class="tooth-tooltip" id="toothTooltip"></div>
        <div class="tooth-arch-container">
          <div class="tooth-arch-section">
            ${upperSvg}
          </div>
          <div class="tooth-arch-section">
            ${lowerSvg}
          </div>
        </div>
      `;
      
      container.innerHTML = html;
      
      // 添加交互提示
      setupToothTooltips(container);
    }

    // 更新治疗方案图
    function updateTreatmentChart() {
      if (!reportData || !reportData.diseased_teeth) {
        const container = document.getElementById('treatmentChartContainer');
        if (container) {
          container.innerHTML = '<div class="tooth-tooltip" id="treatmentTooltip"></div><div style="text-align: center; padding: 40px; color: var(--text-light);">暂无数据</div>';
        }
        return;
      }
      
      const container = document.getElementById('treatmentChartContainer');
      if (!container) return;

      // 构建治疗方案映射
      const toothDataMap = {};
      reportData.diseased_teeth.forEach(tooth => {
        const fdi = tooth.tooth_fdi;
        const diseases = tooth.diseases.map(d => d.label);
        let treatment = '';
        if (diseases.includes('general_caries')) {
          treatment = '根管治疗+洗牙';
        } else if (diseases.includes('twisted tooth')) {
          treatment = '正畸+洗牙';
        } else if (diseases.includes('tooth abrasion')) {
          treatment = '线上问诊';
        }
        
        if (treatment) {
          toothDataMap[fdi] = treatment;
        }
      });

      const simpleToFDI = {
        '1': '11', '2': '12', '3': '13', '4': '14', '5': '15', '6': '16', '7': '17', '8': '18',
        '9': '21', '10': '22', '11': '23', '12': '24', '13': '25', '14': '26', '15': '27', '16': '28',
        '17': '31', '18': '32', '19': '33', '20': '34', '21': '35', '22': '36', '23': '37', '24': '38',
        '25': '41', '26': '42', '27': '43', '28': '44', '29': '45', '30': '46', '31': '47', '32': '48'
      };

      const upperTeeth = ['18', '17', '16', '15', '14', '13', '12', '11', '21', '22', '23', '24', '25', '26', '27', '28'];
      const lowerTeeth = ['48', '47', '46', '45', '44', '43', '42', '41', '31', '32', '33', '34', '35', '36', '37', '38'];

      // 生成上颌SVG (U型布局 - 超大画布，间距特别优化)
      let upperSvg = '<svg class="tooth-arch-svg" viewBox="0 -40 1100 650" xmlns="http://www.w3.org/2000/svg">';
      // 牙弓曲线已移除
      
      const upperPositions = [
        {x: 130, y: 560}, {x: 145, y: 460}, {x: 160, y: 360}, {x: 180, y: 260},
        {x: 225, y: 170}, {x: 305, y: 95}, {x: 390, y: 40}, {x: 490, y: 10},
        {x: 610, y: 10}, {x: 710, y: 40}, {x: 795, y: 95}, {x: 875, y: 170},
        {x: 920, y: 260}, {x: 940, y: 360}, {x: 955, y: 460}, {x: 970, y: 560}
      ];
      
      upperTeeth.forEach((fdi, index) => {
        const pos = upperPositions[index];
        const simpleNum = Object.keys(simpleToFDI).find(k => simpleToFDI[k] === fdi);
        const treatment = toothDataMap[fdi] || (simpleNum ? toothDataMap[simpleNum] : null);
        
        let className = 'normal';
        let treatmentText = '';
        
        if (treatment) {
          className = treatment.includes('线上问诊') ? 'online' : 'offline';
          treatmentText = treatment;
        }
        
        const toothType = getToothType(fdi);
        const toothPath = getToothPath(toothType, pos.x, pos.y);
        
        upperSvg += `
          <g class="tooth-item" data-tooth="${fdi}" data-treatment="${treatmentText}">
            <path class="tooth-shape ${className}" d="${toothPath}" />
            <text class="tooth-number-text" x="${pos.x}" y="${pos.y}">${fdi}</text>
          </g>
        `;
      });
      upperSvg += '</svg>';

      // 生成下颌SVG (U型布局 - 超大画布，间距特别优化)
      let lowerSvg = '<svg class="tooth-arch-svg" viewBox="0 -40 1100 650" xmlns="http://www.w3.org/2000/svg">';
      // 牙弓曲线已移除
      
      const lowerPositions = [
        {x: 130, y: 40}, {x: 145, y: 140}, {x: 160, y: 240}, {x: 180, y: 340},
        {x: 225, y: 430}, {x: 305, y: 505}, {x: 390, y: 560}, {x: 490, y: 590},
        {x: 610, y: 590}, {x: 710, y: 560}, {x: 795, y: 505}, {x: 875, y: 430},
        {x: 920, y: 340}, {x: 940, y: 240}, {x: 955, y: 140}, {x: 970, y: 40}
      ];
      
      lowerTeeth.forEach((fdi, index) => {
        const pos = lowerPositions[index];
        const simpleNum = Object.keys(simpleToFDI).find(k => simpleToFDI[k] === fdi);
        const treatment = toothDataMap[fdi] || (simpleNum ? toothDataMap[simpleNum] : null);
        
        let className = 'normal';
        let treatmentText = '';
        
        if (treatment) {
          className = treatment.includes('线上问诊') ? 'online' : 'offline';
          treatmentText = treatment;
        }
        
        const toothType = getToothType(fdi);
        const toothPath = getToothPath(toothType, pos.x, pos.y);
        
        lowerSvg += `
          <g class="tooth-item" data-tooth="${fdi}" data-treatment="${treatmentText}">
            <path class="tooth-shape ${className}" d="${toothPath}" />
            <text class="tooth-number-text" x="${pos.x}" y="${pos.y}">${fdi}</text>
          </g>
        `;
      });
      lowerSvg += '</svg>';

      let html = `
        <div class="tooth-tooltip" id="treatmentTooltip"></div>
        <div class="tooth-arch-container">
          <div class="tooth-arch-section">
            ${upperSvg}
          </div>
          <div class="tooth-arch-section">
            ${lowerSvg}
          </div>
        </div>
      `;
      
      container.innerHTML = html;
      setupTreatmentTooltips(container);
    }

    // 设置牙齿提示
    function setupToothTooltips(container) {
      const tooltip = document.getElementById('toothTooltip');
      if (!tooltip) {
        console.error('找不到toothTooltip元素');
        return;
      }
      
      // 检查是否是牙齿问题分布图容器
      const isProblemChart = container.id === 'toothChartContainer' || 
                             container.closest('#toothChartContainer') !== null;
      
      const items = container.querySelectorAll('.tooth-item');
      console.log('设置牙齿提示，找到', items.length, '个牙齿');
      
      items.forEach(item => {
        const problems = item.getAttribute('data-problems');
        const toothNum = item.getAttribute('data-tooth');
        let isTooltipShown = false;
        
        // 点击事件（手机和电脑通用）
        item.addEventListener('click', function(e) {
          e.stopPropagation();
          
          // 牙齿问题分布图：始终打开详情页面
          if (isProblemChart) {
            showToothDetail(toothNum);
            return;
          }
          
          // 其他图表：检查是否在图模式下
          if (document.body.classList.contains('image-mode')) {
            // 图模式：显示详情弹窗
            showToothDetail(toothNum);
          } else {
            // 文模式：显示简单tooltip（仅有问题的牙齿）
            if (problems) {
              const position = getToothPosition(toothNum);
              
              if (isTooltipShown) {
                tooltip.classList.remove('show');
                isTooltipShown = false;
              } else {
                tooltip.textContent = `${toothNum}号牙（${position}）：${problems}`;
                tooltip.classList.add('show');
                const rect = container.getBoundingClientRect();
                const itemRect = item.getBoundingClientRect();
                tooltip.style.left = (itemRect.left - rect.left + itemRect.width / 2 - 60) + 'px';
                tooltip.style.top = (itemRect.top - rect.top - 40) + 'px';
                isTooltipShown = true;
                
                setTimeout(() => {
                  tooltip.classList.remove('show');
                  isTooltipShown = false;
                }, 3000);
              }
            }
          }
        });
      });
      
      // 点击页面其他地方隐藏提示框
      document.addEventListener('click', function() {
        tooltip.classList.remove('show');
      });
    }

    // 设置治疗方案提示
    function setupTreatmentTooltips(container) {
      const tooltip = document.getElementById('treatmentTooltip');
      if (!tooltip) {
        console.error('找不到treatmentTooltip元素');
        return;
      }
      
      const items = container.querySelectorAll('.tooth-item');
      console.log('设置治疗方案提示，找到', items.length, '个牙齿');
      
      items.forEach(item => {
        const treatment = item.getAttribute('data-treatment');
        const toothNum = item.getAttribute('data-tooth');
        let isTooltipShown = false;
        
        // 点击事件（手机和电脑通用）
        item.addEventListener('click', function(e) {
          e.stopPropagation();
          
          // 检查是否在图模式下
          if (document.body.classList.contains('image-mode')) {
            // 图模式：显示详情弹窗
            showToothDetail(toothNum);
          } else {
            // 文模式：显示简单tooltip（仅有治疗方案的牙齿）
            if (treatment) {
              const position = getToothPosition(toothNum);
              
              if (isTooltipShown) {
                tooltip.classList.remove('show');
                isTooltipShown = false;
              } else {
                tooltip.textContent = `${toothNum}号牙（${position}）：${treatment}`;
                tooltip.classList.add('show');
                const rect = container.getBoundingClientRect();
                const itemRect = item.getBoundingClientRect();
                tooltip.style.left = (itemRect.left - rect.left + itemRect.width / 2 - 60) + 'px';
                tooltip.style.top = (itemRect.top - rect.top - 40) + 'px';
                isTooltipShown = true;
                
                setTimeout(() => {
                  tooltip.classList.remove('show');
                  isTooltipShown = false;
                }, 3000);
              }
            }
          }
        });
      });
      
      // 点击页面其他地方隐藏提示框
      document.addEventListener('click', function() {
        tooltip.classList.remove('show');
      });
    }

    // 展开/收起功能
    function toggleSection(sectionId) {
      const content = document.getElementById(sectionId + '-content');
      const icon = document.getElementById(sectionId + '-icon');
      
      if (!content || !icon) return;
      
      if (content.style.display === 'none') {
        // 展开
        content.style.display = (sectionId === 'disease-distribution') ? 'flex' : 
                                 (sectionId === 'cause-analysis') ? 'block' : 'block';
        icon.textContent = '▼';
      } else {
        // 折叠
        content.style.display = 'none';
        icon.textContent = '▶';
      }
    }

    // 页面加载时执行 - 优化加载顺序
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', function() {
        console.log('DOM加载完成，开始加载报告数据...');
        // 延迟加载非关键内容
        requestAnimationFrame(() => {
          loadReportData();
        });
      });
    } else {
      // 如果DOM已经加载完成，直接执行
      console.log('DOM已加载，立即加载报告数据...');
      requestAnimationFrame(() => {
        loadReportData();
      });
    }
    
    // 添加移动端触摸交互支持（优化版 - 快速反馈）
    function initTouchInteractions() {
      // 为所有交互元素添加触摸类
      const addTouchClass = (element) => {
        let touchTimeout;
        
        element.addEventListener('touchstart', function(e) {
          // 立即添加激活类
          this.classList.add('touch-active');
          
          // 清除之前的定时器
          if (touchTimeout) {
            clearTimeout(touchTimeout);
          }
        }, {passive: true});
        
        element.addEventListener('touchend', function(e) {
          // 快速回弹 - 100ms后移除，更快的反馈
          touchTimeout = setTimeout(() => {
            this.classList.remove('touch-active');
          }, 100);
        }, {passive: true});
        
        element.addEventListener('touchcancel', function() {
          // 立即移除
          if (touchTimeout) {
            clearTimeout(touchTimeout);
          }
          this.classList.remove('touch-active');
        }, {passive: true});
        
        // 触摸移动时也移除（防止拖动时保持激活状态）
        element.addEventListener('touchmove', function() {
          if (touchTimeout) {
            clearTimeout(touchTimeout);
          }
          this.classList.remove('touch-active');
        }, {passive: true});
      };
      
      // 初始化已存在的元素（只添加最小单元）
      document.querySelectorAll('.stat-item, .stat-box, .disease-stat-card, .cause-image-item, .cause-item, .tooth-item, .overview-image-section img, .treatment-item, .rec-item').forEach(el => {
        addTouchClass(el);
      });
      
      // 监听DOM变化，为新添加的元素也添加触摸支持
      const observer = new MutationObserver(function(mutations) {
        mutations.forEach(function(mutation) {
          mutation.addedNodes.forEach(function(node) {
            if (node.nodeType === 1) {
              if (node.matches && (node.matches('.disease-stat-card') || node.matches('.cause-image-item') || node.matches('.cause-item') || node.matches('.tooth-item') || node.matches('.treatment-item') || node.matches('.rec-item'))) {
                addTouchClass(node);
              }
              node.querySelectorAll && node.querySelectorAll('.disease-stat-card, .cause-image-item, .cause-item, .tooth-item, .treatment-item, .rec-item').forEach(el => {
                addTouchClass(el);
              });
            }
          });
        });
      });
      
      observer.observe(document.body, {
        childList: true,
        subtree: true
      });
    }
    
    // 图片全屏查看功能
    function initImageFullscreen() {
      // 创建全屏遮罩
      const overlay = document.createElement('div');
      overlay.className = 'image-fullscreen-overlay';
      overlay.innerHTML = '<div class="image-fullscreen-close">×</div>';
      document.body.appendChild(overlay);
      
      // 图片点击事件
      function showFullscreen(imgSrc) {
        const img = document.createElement('img');
        img.src = imgSrc;
        img.alt = '全屏查看';
        
        // 清空之前的图片
        const existingImg = overlay.querySelector('img');
        if (existingImg) {
          existingImg.remove();
        }
        
        overlay.appendChild(img);
        overlay.classList.add('active');
        document.body.style.overflow = 'hidden'; // 禁止背景滚动
      }
      
      // 关闭全屏
      function closeFullscreen() {
        overlay.classList.remove('active');
        document.body.style.overflow = ''; // 恢复滚动
        setTimeout(() => {
          const img = overlay.querySelector('img:not(.image-fullscreen-close)');
          if (img) img.remove();
        }, 300);
      }
      
      // 点击遮罩或关闭按钮关闭
      overlay.addEventListener('click', function(e) {
        if (e.target === overlay || e.target.classList.contains('image-fullscreen-close')) {
          closeFullscreen();
        }
      });
      
      // ESC键关闭
      document.addEventListener('keydown', function(e) {
        if (e.key === 'Escape' && overlay.classList.contains('active')) {
          closeFullscreen();
        }
      });
      
      // 为所有图片添加点击全屏功能
      function attachImageClick(img) {
        img.style.cursor = 'zoom-in';
        img.addEventListener('click', function(e) {
          e.stopPropagation();
          showFullscreen(this.src);
        });
      }
      
      // 初始化现有图片
      document.querySelectorAll('.cause-image-item img, .overview-image-section img').forEach(img => {
        attachImageClick(img);
      });
      
      // 监听新添加的图片
      const imgObserver = new MutationObserver(function(mutations) {
        mutations.forEach(function(mutation) {
          mutation.addedNodes.forEach(function(node) {
            if (node.nodeType === 1) {
              if (node.tagName === 'IMG' && (node.closest('.cause-image-item') || node.closest('.overview-image-section'))) {
                attachImageClick(node);
              }
              node.querySelectorAll && node.querySelectorAll('.cause-image-item img, .overview-image-section img').forEach(img => {
                attachImageClick(img);
              });
            }
          });
        });
      });
      
      imgObserver.observe(document.body, {
        childList: true,
        subtree: true
      });
    }
    
    // 页面加载完成后初始化
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', function() {
        initTouchInteractions();
        initImageFullscreen();
      });
    } else {
      initTouchInteractions();
      initImageFullscreen();
    }
    
    // 添加window.onerror来捕获错误
    window.addEventListener('error', function(e) {
      console.error('页面错误:', e.message, e.filename, e.lineno);
    });
    
    // ============ 牙齿详情模态框功能 ============
    
    // 显示牙齿详情
    function showToothDetail(toothFdi) {
      const modal = document.getElementById('toothDetailModal');
      const title = document.getElementById('modalToothTitle');
      const subtitle = document.getElementById('modalToothSubtitle');
      const body = document.getElementById('modalToothBody');
      
      if (!reportData || !reportData.diseased_teeth) {
        return;
      }
      
      // 查找牙齿数据
      const simpleToFDI = {
        '1': '11', '2': '12', '3': '13', '4': '14', '5': '15', '6': '16', '7': '17', '8': '18',
        '9': '21', '10': '22', '11': '23', '12': '24', '13': '25', '14': '26', '15': '27', '16': '28',
        '17': '31', '18': '32', '19': '33', '20': '34', '21': '35', '22': '36', '23': '37', '24': '38',
        '25': '41', '26': '42', '27': '43', '28': '44', '29': '45', '30': '46', '31': '47', '32': '48'
      };
      
      const simpleNum = Object.keys(simpleToFDI).find(k => simpleToFDI[k] === toothFdi);
      const toothData = reportData.diseased_teeth.find(t => 
        t.tooth_fdi === toothFdi || t.tooth_fdi === simpleNum
      );
      
      const position = getToothPosition(toothFdi);
      
      // 设置标题
      title.textContent = `${toothFdi}号牙 - ${position}`;
      
      if (!toothData) {
        // 正常牙齿
        subtitle.innerHTML = '<span class="tooth-status-badge normal">健康</span>';
        body.innerHTML = `
          <div class="tooth-detail-section">
            <h3>健康状态</h3>
            <div class="tooth-detail-text">
              <p>该牙齿未检测到明显问题，状态良好。</p>
              <p>建议继续保持良好的口腔卫生习惯：</p>
              <ul>
                <li>每天至少刷牙两次，每次至少2分钟</li>
                <li>使用牙线清洁牙间隙</li>
                <li>定期进行口腔检查（建议每6个月一次）</li>
                <li>避免过硬食物，保护牙齿</li>
              </ul>
            </div>
          </div>
        `;
      } else {
        // 有问题的牙齿
        const diseases = toothData.diseases.map(d => DISEASE_NAMES[d.label] || d.label);
        const uniqueDiseases = [...new Set(diseases)];
        const diseasesText = uniqueDiseases.join('、');
        
        const statusClass = uniqueDiseases.length > 1 ? 'danger' : 'warning';
        const statusText = uniqueDiseases.length > 1 ? '多种问题' : '单一问题';
        
        subtitle.innerHTML = `<span class="tooth-status-badge ${statusClass}">${statusText}：${diseasesText}</span>`;
        
        // 生成图片部分
        let imagesHtml = '';
        if (toothData.square_crop_path) {
          imagesHtml = `
            <div class="tooth-detail-section">
              <h3>检测图像</h3>
              <div class="tooth-detail-images">
                <div class="tooth-detail-image">
                  <img src="${toothData.square_crop_path}" alt="${toothFdi}号牙" loading="lazy">
                </div>
              </div>
            </div>
          `;
        }
        
        // 生成病因分析
        let causesHtml = '';
        uniqueDiseases.forEach(diseaseName => {
          const reasons = getCauseReasons(diseaseName);
          const preventions = getPreventionAdvice(diseaseName);
          causesHtml += `
            <div style="margin-bottom: 24px;">
              <h4 style="color: var(--brand-green); font-size: 18px; margin-bottom: 12px;">${diseaseName}</h4>
              <div style="margin-bottom: 16px;">
                <strong style="color: var(--text-dark);">可能原因：</strong>
                <ul style="margin: 8px 0; padding-left: 24px; line-height: 1.8; color: var(--text-light);">
                  ${reasons}
                </ul>
              </div>
              <div>
                <strong style="color: var(--text-dark);">预防与护理建议：</strong>
                <ul style="margin: 8px 0; padding-left: 24px; line-height: 1.8; color: var(--text-light);">
                  ${preventions}
                </ul>
              </div>
            </div>
          `;
        });
        
        // 生成治疗方案
        let treatmentHtml = getTreatmentRecommendation(uniqueDiseases);
        
        body.innerHTML = `
          ${imagesHtml}
          <div class="tooth-detail-section">
            <h3>病因分析</h3>
            <div class="tooth-detail-text">
              ${causesHtml}
            </div>
          </div>
          <div class="tooth-detail-section">
            <h3>治疗建议</h3>
            <div class="tooth-detail-text">
              ${treatmentHtml}
            </div>
          </div>
        `;
      }
      
      // 显示模态框
      modal.classList.add('active');
      document.body.style.overflow = 'hidden';
    }
    
    // 关闭牙齿详情
    function closeToothDetail() {
      const modal = document.getElementById('toothDetailModal');
      modal.classList.remove('active');
      document.body.style.overflow = '';
    }
    
    // 获取治疗建议
    function getTreatmentRecommendation(diseases) {
      let html = '';
      
      if (diseases.includes('龋齿')) {
        html += `
          <div style="margin-bottom: 16px; padding: 16px; background: var(--bg-lighter); border-radius: 8px; border-left: 4px solid var(--brand-green);">
            <strong style="color: var(--text-dark); font-size: 16px;">补牙治疗</strong>
            <p style="margin: 8px 0 0 0;">建议及时进行龋齿充填治疗，清除龋坏组织后使用复合树脂等材料修复，防止龋齿继续发展。如果龋齿较深，可能需要进行根管治疗。</p>
          </div>
        `;
      }
      
      if (diseases.includes('磨损')) {
        html += `
          <div style="margin-bottom: 16px; padding: 16px; background: var(--bg-lighter); border-radius: 8px; border-left: 4px solid var(--brand-green);">
            <strong style="color: var(--text-dark); font-size: 16px;">磨损修复</strong>
            <p style="margin: 8px 0 0 0;">对于轻度磨损，可使用脱敏牙膏缓解敏感；中度磨损建议使用复合树脂修复；重度磨损可能需要进行牙冠修复。如有夜磨牙习惯，建议佩戴防护牙套。</p>
          </div>
        `;
      }
      
      if (diseases.includes('扭转') || diseases.includes('倾斜')) {
        html += `
          <div style="margin-bottom: 16px; padding: 16px; background: var(--bg-lighter); border-radius: 8px; border-left: 4px solid var(--brand-green);">
            <strong style="color: var(--text-dark); font-size: 16px;">正畸治疗</strong>
            <p style="margin: 8px 0 0 0;">建议咨询正畸专科医生，评估是否需要进行矫正治疗。可选择传统托槽矫治或隐形矫治器，改善牙齿排列，提升美观和功能。</p>
          </div>
        `;
      }
      
      html += `
        <div style="margin-top: 16px; padding: 16px; background: #E3F2FD; border-radius: 8px;">
          <strong style="color: #1976D2;">温馨提示：</strong>
          <p style="margin: 8px 0 0 0; color: #424242;">以上建议仅供参考，具体治疗方案请咨询专业口腔医生。建议尽快到正规口腔医疗机构进行详细检查和治疗。</p>
        </div>
      `;
      
      return html;
    }
    
    // 点击模态框外部关闭
    document.addEventListener('click', function(e) {
      const modal = document.getElementById('toothDetailModal');
      if (e.target === modal) {
        closeToothDetail();
      }
    });
    
    // ESC键关闭模态框
    document.addEventListener('keydown', function(e) {
      if (e.key === 'Escape') {
        closeToothDetail();
      }
    });
    
  </script>
</head>
<body>
  <!-- 牙齿详情模态框 -->
  <div class="tooth-detail-modal" id="toothDetailModal">
    <div class="tooth-detail-content">
      <div class="tooth-detail-header">
        <div class="tooth-detail-close" onclick="closeToothDetail()">×</div>
        <h2 class="tooth-detail-title" id="modalToothTitle">牙齿详情</h2>
        <p class="tooth-detail-subtitle" id="modalToothSubtitle">点击查看详细信息</p>
      </div>
      <div class="tooth-detail-body" id="modalToothBody">
        <!-- 动态内容将在这里插入 -->
      </div>
    </div>
  </div>
  
  <!-- 封面 -->
  <div class="page cover">
    <img class="logo-large" src="images/logocombine.png" alt="渡生科技 Logo" loading="eager" decoding="async">
    <div style="font-size: 14px; font-family: 'Courier New', monospace; margin-bottom: 20px; position: relative; z-index: 1;">
      <span style="color: var(--brand-green);">报告编号：</span><span class="report-id-number-cover" style="color: var(--brand-green); font-weight: 600;">DY-20251203-ZH001-A7B9</span>
    </div>
    <h1>口腔健康评估报告</h1>
    <p class="subtitle">Oral Health Assessment Report</p>
    <p class="cover-date"><span id="report-date" style="color: var(--brand-green);">2025年12月03日</span> <span id="report-time" style="color: var(--brand-green);">14:30</span></p>
    
    <div class="cover-summary">
      <h2>检测概览</h2>
      <div class="stat">
        <div class="stat-item">
          <div class="stat-number" id="cover-problem-teeth">10</div>
          <div class="stat-label">问题牙齿</div>
        </div>
        <div class="stat-item">
          <div class="stat-number" id="cover-total-problems">20</div>
          <div class="stat-label">病变数量</div>
        </div>
        <div class="stat-item">
          <div class="stat-number" id="cover-health-score">75</div>
          <div class="stat-label">健康评分</div>
        </div>
      </div>
      
      <!-- 雷达图 - 6个健康维度 -->
      <div class="cover-radar">
        <div class="radar-chart">
          <svg width="500" height="500" xmlns="http://www.w3.org/2000/svg" viewBox="-80 -50 560 500" style="overflow: visible;">
            <defs>
              <style>
                .radar-grid { stroke: var(--brand-green); stroke-width: 1; fill: none; opacity: 0.3; }
                .radar-axis { stroke: var(--brand-blue); stroke-width: 2; }
                .radar-area { fill: rgba(143, 195, 31, 0.3); stroke: var(--brand-green); stroke-width: 2; }
                .radar-point { fill: var(--brand-green); }
                .radar-label { font-family: 'Microsoft YaHei', Arial, sans-serif; font-size: 18px; fill: var(--text-medium); font-weight: bold; }
                .radar-value { font-family: Arial, sans-serif; font-size: 16px; fill: var(--brand-green); font-weight: bold; }
              </style>
            </defs>
            <!-- 背景网格 - 4层同心圆 (25%, 50%, 75%, 100%) -->
            <circle cx="200" cy="200" r="37.5" class="radar-grid"/>
            <circle cx="200" cy="200" r="75" class="radar-grid"/>
            <circle cx="200" cy="200" r="112.5" class="radar-grid"/>
            <circle cx="200" cy="200" r="150" class="radar-grid"/>
            <!-- 轴线 - 6个维度，每个60度 -->
            <line x1="200" y1="200" x2="200" y2="50" class="radar-axis"/>
            <line x1="200" y1="200" x2="373.2" y2="125" class="radar-axis"/>
            <line x1="200" y1="200" x2="373.2" y2="275" class="radar-axis"/>
            <line x1="200" y1="200" x2="200" y2="350" class="radar-axis"/>
            <line x1="200" y1="200" x2="26.8" y2="275" class="radar-axis"/>
            <line x1="200" y1="200" x2="26.8" y2="125" class="radar-axis"/>
            <!-- 数据区域 - 示例数据 -->
            <path d="M 200,80 L 320,140 L 320,260 L 200,320 L 80,260 L 80,140 Z" class="radar-area"/>
            <!-- 数据点 -->
            <circle cx="200" cy="80" r="4" class="radar-point"/>
            <circle cx="320" cy="140" r="4" class="radar-point"/>
            <circle cx="320" cy="260" r="4" class="radar-point"/>
            <circle cx="200" cy="320" r="4" class="radar-point"/>
            <circle cx="80" cy="260" r="4" class="radar-point"/>
            <circle cx="80" cy="140" r="4" class="radar-point"/>
            <!-- 标签 - 调整位置避免超出框 -->
            <text x="200" y="15" text-anchor="middle" class="radar-label">牙齿颜色</text>
            <text x="400" y="140" text-anchor="middle" class="radar-label">牙体健康</text>
            <text x="400" y="275" text-anchor="middle" class="radar-label">牙周健康</text>
            <text x="200" y="385" text-anchor="middle" class="radar-label">牙列整齐</text>
            <text x="0" y="275" text-anchor="middle" class="radar-label">牙列完整</text>
            <text x="0" y="140" text-anchor="middle" class="radar-label">口腔卫生</text>
            <!-- 数值 (0-100分) -->
            <text x="200" y="65" text-anchor="middle" class="radar-value">75</text>
            <text x="340" y="125" text-anchor="middle" class="radar-value">70</text>
            <text x="340" y="260" text-anchor="middle" class="radar-value">85</text>
            <text x="200" y="305" text-anchor="middle" class="radar-value">60</text>
            <text x="60" y="260" text-anchor="middle" class="radar-value">90</text>
            <text x="60" y="140" text-anchor="middle" class="radar-value">65</text>
          </svg>
        </div>
      </div>
      
      <div class="summary-text">
        <p><strong>主要发现：</strong></p>
        <ul id="main-findings" style="margin: 8px 0; padding-left: 24px; line-height: 1.8;">
          <li>正在加载数据...</li>
        </ul>
        <p style="margin-top: 16px;" id="personalized-assessment"><strong>个性化评估：</strong>正在生成个性化评估...</p>
        <p style="margin-top: 12px;" id="custom-advice"><strong>专属建议：</strong>正在生成专属建议...</p>
      </div>
    </div>
  </div>

  <!-- 报告内容 -->
  <div class="page">
    <div class="topbar"></div>
    <div class="header">
      <div>
        <span class="badge">AI智能分析</span>
        <h1>口腔健康<span class="report-tag">评估报告</span></h1>
      </div>
      <div style="text-align: right;">
        <div style="font-size: 12px; margin-bottom: 8px; font-family: 'Courier New', monospace;">
          <span style="color: var(--brand-green);">报告编号：</span><span class="report-id-number" style="color: var(--brand-green); font-weight: 600;">DY-20251203-ZH001-A7B9</span>
        </div>
      </div>
    </div>
    
    <div class="layout">
    <!-- 全景图模块 -->
    <div class="overview-image-section">
      <h3 style="margin: 0 0 16px 0; color: var(--text-dark); font-size: 22px; display: flex; align-items: center; font-weight: 700;">
        <span style="display: inline-block; width: 6px; height: 24px; background: linear-gradient(180deg, var(--brand-green) 0%, var(--brand-blue) 100%); border-radius: 3px; margin-right: 12px;"></span>
        全景检测图像
      </h3>
      <img src="images/原始照片_overview.png" alt="口腔全景图" loading="lazy" decoding="async">
    </div>

    <div class="section" style="padding: 10px 5px;">
      <h3>牙齿问题分布图</h3>
      <div class="tooth-chart" id="toothChartContainer">
        <div class="tooth-tooltip" id="toothTooltip"></div>
        <!-- 动态生成的内容将插入这里 -->
        <div style="text-align: center; padding: 40px; color: var(--text-light);">加载中...</div>
      </div>
      <p class="legend" style="display: flex; justify-content: center; align-items: center; gap: 20px; flex-wrap: nowrap; margin-top: 20px; padding-top: 10px; position: relative; z-index: 10;">
        <span style="display: inline-flex; align-items: center; gap: 6px; white-space: nowrap;">
          <svg width="20" height="15" style="vertical-align: middle;"><rect width="20" height="15" rx="2" fill="#E8F5E9" stroke="var(--brand-green)" stroke-width="2"/></svg>
          <span style="font-size: 13px; color: var(--text-medium);">正常</span>
        </span>
        <span style="display: inline-flex; align-items: center; gap: 6px; white-space: nowrap;">
          <svg width="20" height="15" style="vertical-align: middle;"><rect width="20" height="15" rx="2" fill="#FFD54F" stroke="#F57C00" stroke-width="3"/></svg>
          <span style="font-size: 13px; color: var(--text-medium);">单个问题</span>
        </span>
        <span style="display: inline-flex; align-items: center; gap: 6px; white-space: nowrap;">
          <svg width="20" height="15" style="vertical-align: middle;"><rect width="20" height="15" rx="2" fill="#FF7043" stroke="#D84315" stroke-width="3"/></svg>
          <span style="font-size: 13px; color: var(--text-medium);">多种问题</span>
        </span>
      </p>
    </div>
    
    </div>
    
    <footer>
      <div style="text-align: center; margin-bottom: 20px;">
        <img class="logo" src="images/logocombine.png" alt="Logo" style="opacity: 0.8; height: 60px; margin: 0 auto; display: block;" loading="lazy" decoding="async">
      </div>
      <p style="text-align: center;"><strong>渡生科技 - 渡芽AI智能口腔健康评估系统</strong></p>
      <p style="text-align: center;">本报告由AI智能分析系统自动生成，仅供参考。如有疑问，请咨询专业口腔医生。</p>
      <p style="margin-top: 8px; font-size: 12px; color: #999; text-align: center;">报告生成时间：<span id="footer-date">2025年12月03日</span> <span id="footer-time">13:03</span> | 版本：v3.0.0</p>
    </footer>
  </div>
</body>
</html>
